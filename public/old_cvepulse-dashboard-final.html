<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CVEPulse - Live Emergency Intelligence</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: rgba(30, 41, 59, 0.8);
      --cyan: #22d3ee;
      --cyan-dark: #0891b2;
      --text-primary: #ffffff;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --critical: #ef4444;
      --high: #f97316;
      --medium: #eab308;
      --low: #22c55e;
      --border: rgba(148, 163, 184, 0.1);
    }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, #1a2744 50%, var(--bg-primary) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    
    .container { max-width: 1400px; margin: 0 auto; padding: 0 24px; }
    
    header {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 16px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .logo { display: flex; align-items: center; gap: 10px; }
    .logo svg { stroke: var(--cyan); fill: none; stroke-width: 1.5; }
    .logo h1 { font-size: 22px; font-weight: 700; color: var(--cyan); font-style: italic; }
    
    .header-right { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
    .last-updated { color: var(--text-muted); font-size: 12px; }
    
    .live-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--low);
      font-size: 13px;
      font-weight: 600;
    }
    
    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--low);
      border-radius: 50%;
      animation: pulse 2s infinite;
      box-shadow: 0 0 8px var(--low);
    }
    
    .data-source {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 500;
    }
    
    .data-source.live { background: rgba(34,197,94,0.2); color: var(--low); }
    .data-source.demo { background: rgba(234,179,8,0.2); color: var(--medium); }
    
    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }
    
    .btn-primary { background: var(--cyan); color: var(--bg-primary); font-weight: 600; }
    .btn-secondary { background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    
    .page-header { padding: 32px 0; margin-bottom: 8px; }
    .page-header h2 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
    .page-header h2 span { color: var(--cyan); }
    .page-header p { color: var(--text-secondary); font-size: 15px; }
    
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 80px 20px;
      text-align: center;
    }
    
    .loading svg { animation: spin 1s linear infinite; color: var(--cyan); margin-bottom: 16px; }
    
    /* CISO Action Banner */
    .ciso-banner {
      background: linear-gradient(135deg, rgba(34, 211, 238, 0.1) 0%, rgba(34, 211, 238, 0.02) 100%);
      border: 1px solid rgba(34, 211, 238, 0.3);
      border-radius: 12px;
      padding: 20px 24px;
      margin-bottom: 24px;
    }
    
    .ciso-banner h3 {
      font-size: 14px;
      font-weight: 700;
      color: var(--cyan);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ciso-actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
    }
    
    .ciso-action-item {
      background: rgba(15, 23, 42, 0.6);
      border-radius: 8px;
      padding: 14px;
      border-left: 4px solid;
    }
    
    .ciso-action-item.p1 { border-color: var(--critical); }
    .ciso-action-item.p2 { border-color: var(--high); }
    .ciso-action-item.p3 { border-color: var(--medium); }
    
    .ciso-action-priority {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    
    .ciso-action-priority.p1 { color: var(--critical); }
    .ciso-action-priority.p2 { color: var(--high); }
    .ciso-action-priority.p3 { color: var(--medium); }
    
    .ciso-action-text { font-size: 13px; font-weight: 600; margin-bottom: 2px; }
    .ciso-action-context { font-size: 11px; color: var(--text-muted); }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: all 0.2s;
    }
    
    .stat-card:hover { border-color: var(--cyan); transform: translateY(-2px); }
    .stat-card.highlight { border-color: rgba(239,68,68,0.5); background: rgba(239,68,68,0.05); }
    .stat-value { font-size: 36px; font-weight: 800; margin-bottom: 4px; }
    .stat-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
    
    .filters {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .search-box {
      display: flex;
      align-items: center;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0 12px;
      flex: 1;
      min-width: 200px;
      max-width: 300px;
    }
    
    .search-box input {
      flex: 1;
      padding: 10px 12px;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 13px;
      outline: none;
    }
    
    .search-box input::placeholder { color: var(--text-muted); }
    
    .filter-btn {
      padding: 10px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .filter-btn:hover { border-color: var(--cyan); color: var(--text-primary); }
    .filter-btn.active { background: var(--cyan); border-color: var(--cyan); color: var(--bg-primary); }
    
    .results-count { color: var(--text-muted); font-size: 14px; margin-bottom: 16px; }
    
    .vuln-card {
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 18px;
      margin-bottom: 16px;
      transition: all 0.2s;
    }
    
    .vuln-card:hover { border-color: var(--cyan); background: rgba(15, 23, 42, 0.7); }
    .vuln-card.critical { border-left: 4px solid var(--critical); }
    .vuln-card.high { border-left: 4px solid var(--high); }
    .vuln-card.medium { border-left: 4px solid var(--medium); }
    
    .vuln-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .vuln-cve {
      font-size: 16px;
      font-weight: 700;
      color: var(--cyan);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .vuln-cve:hover { text-decoration: underline; }
    
    .badges { display: flex; gap: 6px; flex-wrap: wrap; }
    
    .badge {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    
    .badge-new { background: var(--low); color: #000; }
    .badge-zero-day { background: var(--critical); color: #fff; }
    .badge-no-patch { background: var(--high); color: #fff; }
    .badge-kev { background: rgba(234,179,8,0.2); color: var(--medium); border: 1px solid rgba(234,179,8,0.3); }
    .badge-epss { background: rgba(239,68,68,0.15); color: #fca5a5; border: 1px solid rgba(239,68,68,0.3); }
    .badge-ransomware { background: rgba(168,85,247,0.2); color: #c084fc; border: 1px solid rgba(168,85,247,0.3); }
    .badge-patch { background: rgba(34,197,94,0.2); color: var(--low); border: 1px solid rgba(34,197,94,0.3); }
    
    .vuln-product { font-size: 14px; font-weight: 600; margin-bottom: 6px; }
    .vuln-desc { font-size: 13px; color: var(--text-secondary); margin-bottom: 16px; line-height: 1.5; }
    
    .vuln-meta {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    
    .meta-item { display: flex; flex-direction: column; }
    .meta-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 2px; }
    .meta-value { font-size: 14px; font-weight: 600; }
    .meta-value.critical { color: var(--critical); }
    .meta-value.high { color: var(--high); }
    .meta-value.good { color: var(--low); }
    
    /* Clickable links in meta values */
    .vuln-meta a:hover .meta-value,
    .vuln-product a:hover {
      border-bottom-style: solid !important;
      opacity: 0.9;
    }
    
    /* Action Guidance Box */
    .action-guidance {
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 16px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    
    .action-guidance-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 16px;
    }
    
    .action-guidance-icon.block { background: rgba(239,68,68,0.2); }
    .action-guidance-icon.patch { background: rgba(34,197,94,0.2); }
    .action-guidance-icon.mitigate { background: rgba(249,115,22,0.2); }
    
    .action-guidance-content { flex: 1; }
    .action-guidance-title { font-size: 12px; font-weight: 700; margin-bottom: 2px; }
    .action-guidance-title.block { color: var(--critical); }
    .action-guidance-title.patch { color: var(--low); }
    .action-guidance-title.mitigate { color: var(--high); }
    .action-guidance-text { font-size: 11px; color: var(--text-secondary); line-height: 1.4; }
    
    .vuln-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    
    .action-btn {
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    
    .action-btn:hover { transform: translateY(-1px); }
    .action-btn.primary { background: var(--cyan); color: var(--bg-primary); }
    .action-btn.patch { background: var(--low); color: #000; }
    .action-btn.block { background: var(--critical); color: #fff; }
    .action-btn.mitigate { background: var(--high); color: #fff; }
    .action-btn.secondary { background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }
    
    .empty-state svg { margin-bottom: 16px; opacity: 0.5; }
    
    footer {
      border-top: 1px solid var(--border);
      padding: 24px 0;
      margin-top: 40px;
    }
    
    .footer-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .footer-sources { font-size: 12px; color: var(--text-muted); }
    .footer-brand { font-size: 13px; color: var(--text-secondary); }
    
    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
    }
    
    .modal-header h3 {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.2s;
    }
    
    .modal-close:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .notification-section {
      margin-bottom: 24px;
    }
    
    .notification-section:last-child {
      margin-bottom: 0;
    }
    
    .notification-section h4 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .notification-section p {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 12px;
      line-height: 1.5;
    }
    
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    
    .input-group input {
      flex: 1;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 13px;
      outline: none;
    }
    
    .input-group input:focus {
      border-color: var(--cyan);
    }
    
    .input-group input::placeholder {
      color: var(--text-muted);
    }
    
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-badge.connected {
      background: rgba(34, 197, 94, 0.2);
      color: var(--low);
    }
    
    .status-badge.disconnected {
      background: rgba(148, 163, 184, 0.2);
      color: var(--text-muted);
    }
    
    .help-link {
      font-size: 12px;
      color: var(--cyan);
      text-decoration: none;
    }
    
    .help-link:hover {
      text-decoration: underline;
    }
    
    .test-result {
      margin-top: 12px;
      padding: 12px;
      border-radius: 8px;
      font-size: 12px;
      display: none;
    }
    
    .test-result.success {
      display: block;
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.3);
      color: var(--low);
    }
    
    .test-result.error {
      display: block;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: var(--critical);
    }
    
    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .stat-value { font-size: 28px; }
    }
    
    /* Export Dropdown */
    .export-dropdown {
      position: relative;
      display: inline-block;
    }
    
    .export-menu {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 8px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      min-width: 200px;
      z-index: 1000;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    
    .export-menu.show {
      display: block;
    }
    
    .export-menu button {
      display: block;
      width: 100%;
      padding: 12px 16px;
      background: none;
      border: none;
      color: var(--text-primary);
      font-size: 13px;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .export-menu button:hover {
      background: var(--bg-secondary);
      color: var(--cyan);
    }
    
    /* Watchlist Badge */
    .watchlist-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      background: rgba(34, 211, 238, 0.2);
      border: 1px solid rgba(34, 211, 238, 0.3);
      border-radius: 4px;
      font-size: 10px;
      color: var(--cyan);
      font-weight: 600;
    }
    
    /* Watchlist Tags in Filters */
    .watchlist-filters {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
      padding: 12px;
      background: rgba(34, 211, 238, 0.05);
      border: 1px solid rgba(34, 211, 238, 0.2);
      border-radius: 8px;
    }
    
    .watchlist-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px;
      color: var(--text-primary);
    }
    
    .watchlist-tag .remove {
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.2s;
    }
    
    .watchlist-tag .remove:hover {
      opacity: 1;
      color: var(--critical);
    }
    
    .watchlist-tag.active {
      background: var(--cyan);
      border-color: var(--cyan);
      color: var(--bg-primary);
    }
    
    /* API Key Display */
    .api-key-box {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      font-family: monospace;
      font-size: 12px;
      word-break: break-all;
      position: relative;
    }
    
    .api-key-box .copy-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--cyan);
      color: var(--bg-primary);
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
    }
    
    /* Pricing Cards */
    .pricing-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .pricing-card:hover {
      border-color: var(--cyan);
      transform: translateY(-4px);
    }
    
    .pricing-card.popular {
      border: 2px solid var(--cyan);
      background: linear-gradient(135deg, rgba(34, 211, 238, 0.1) 0%, var(--bg-secondary) 100%);
    }
    
    .pricing-card.enterprise {
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.1) 0%, var(--bg-secondary) 100%);
    }
    
    .pricing-badge {
      position: absolute;
      top: -10px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--cyan);
      color: var(--bg-primary);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 10px;
      font-weight: 700;
    }
    
    .pricing-tier {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    
    .pricing-price {
      font-size: 24px;
      font-weight: 800;
      color: var(--cyan);
      margin-bottom: 16px;
    }
    
    .pricing-price span {
      font-size: 12px;
      font-weight: 400;
      color: var(--text-muted);
    }
    
    .pricing-features {
      list-style: none;
      text-align: left;
      margin-bottom: 20px;
    }
    
    .pricing-features li {
      font-size: 12px;
      color: var(--text-secondary);
      padding: 6px 0;
      border-bottom: 1px solid var(--border);
    }
    
    .pricing-features li:last-child {
      border-bottom: none;
    }
    
    .pricing-current {
      background: var(--bg-primary);
      color: var(--text-muted);
      padding: 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
    }
    
    /* Service Cards */
    .service-card {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .service-card:hover {
      border-color: var(--cyan);
      background: rgba(34, 211, 238, 0.05);
    }
    
    .service-icon {
      font-size: 24px;
    }
    
    .service-info {
      flex: 1;
    }
    
    .service-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
    }
    
    .service-desc {
      font-size: 11px;
      color: var(--text-muted);
    }
    
    .service-arrow {
      color: var(--cyan);
      font-size: 18px;
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .service-card:hover .service-arrow {
      opacity: 1;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-inner">
        <a href="https://www.cvepulse.com" class="logo" style="text-decoration: none;">
          <svg width="32" height="32" viewBox="0 0 24 24">
            <path d="M12 2L3 7v6c0 5.25 3.75 10.125 9 11.25 5.25-1.125 9-6 9-11.25V7l-9-5z" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <h1>CVEPulse</h1>
        </a>
        <div class="header-right">
          <span class="last-updated">Updated: <span id="update-time">--</span></span>
          <span class="data-source" id="data-source">Loading...</span>
          <span class="live-badge"><span class="live-dot"></span> Live</span>
          <button class="btn btn-secondary" id="refresh-btn" onclick="fetchAllData()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
            </svg>
            Refresh
          </button>
          <button class="btn btn-secondary" onclick="openWatchlistModal()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
            </svg>
            Watchlist
          </button>
          <button class="btn btn-secondary" onclick="openPricingModal()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
            </svg>
            Pricing
          </button>
          <button class="btn btn-secondary" onclick="openNotificationSettings()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0"/>
            </svg>
            Alerts
          </button>
          <div class="export-dropdown">
            <button class="btn btn-primary" onclick="toggleExportMenu()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
              </svg>
              Export ‚ñæ
            </button>
            <div class="export-menu" id="export-menu">
              <button onclick="exportCSV()">üìä Export CSV</button>
              <button onclick="generatePDFReport()">üìÑ PDF Executive Report</button>
              <button onclick="exportJSON()">üîß Export JSON (API)</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <h2>Emergency <span>Intelligence Dashboard</span></h2>
      <p id="catalog-info">Loading vulnerability data... <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog" target="_blank" style="color: var(--cyan); text-decoration: none; font-size: 12px;">[View CISA KEV Catalog]</a></p>
    </div>

    <div class="loading" id="loading-state">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
      </svg>
      <p style="font-size: 16px; color: var(--cyan);">Loading vulnerability data...</p>
    </div>

    <div id="main-content" style="display: none;">
      <!-- CISO Action Summary -->
      <div class="ciso-banner">
        <h3>üìã CISO Action Summary ‚Äî Priority Tasks for Today</h3>
        <div class="ciso-actions-grid" id="ciso-actions"></div>
      </div>

      <div class="stats-grid" id="stats-grid"></div>

      <div class="filters">
        <div class="search-box">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--text-muted);">
            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          <input type="text" id="search-input" placeholder="Search CVE, vendor, product..." oninput="applyFilters()">
        </div>
        <button class="filter-btn active" data-filter="new-week" onclick="setFilter('new-week')">New This Week</button>
        <button class="filter-btn" data-filter="new-month" onclick="setFilter('new-month')">New This Month</button>
        <button class="filter-btn" data-filter="no-patch" onclick="setFilter('no-patch')">No Patch ‚ö†Ô∏è</button>
        <button class="filter-btn" data-filter="urgent" onclick="setFilter('urgent')">Due Soon</button>
        <button class="filter-btn" data-filter="overdue" onclick="setFilter('overdue')">Overdue</button>
        <button class="filter-btn" data-filter="ransomware" onclick="setFilter('ransomware')">Ransomware</button>
        <button class="filter-btn" data-filter="watchlist" onclick="setFilter('watchlist')" id="watchlist-filter-btn" style="display: none;">
          üëÅÔ∏è Watchlist (<span id="watchlist-count">0</span>)
        </button>
      </div>
      
      <!-- Watchlist Tags Display -->
      <div class="watchlist-filters" id="watchlist-tags-container" style="display: none;">
        <span style="font-size: 12px; color: var(--text-muted); margin-right: 8px;">Watching:</span>
        <div id="watchlist-tags"></div>
      </div>

      <div class="results-count" id="results-count">Loading...</div>
      <div id="vuln-list"></div>
    </div>
  </main>

  <!-- Pricing Modal -->
  <div class="modal-overlay" id="pricing-modal">
    <div class="modal" style="max-width: 900px;">
      <div class="modal-header">
        <h3>üíº Plans & Services</h3>
        <button class="modal-close" onclick="closePricingModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
        
        <!-- Pricing Cards -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
          
          <!-- Free Tier -->
          <div class="pricing-card">
            <div class="pricing-tier">Free</div>
            <div class="pricing-price">‚Çπ0<span>/forever</span></div>
            <ul class="pricing-features">
              <li>‚úÖ Live KEV Dashboard</li>
              <li>‚úÖ EPSS Scores</li>
              <li>‚úÖ Browser Alerts</li>
              <li>‚úÖ 1 CSV Export/day</li>
              <li>‚úÖ 3 Watchlist Vendors</li>
              <li>‚ùå PDF Reports</li>
              <li>‚ùå Slack/Teams Alerts</li>
              <li>‚ùå API Access</li>
            </ul>
            <div class="pricing-current">Current Plan</div>
          </div>
          
          <!-- Pro Tier -->
          <div class="pricing-card popular">
            <div class="pricing-badge">MOST POPULAR</div>
            <div class="pricing-tier">Pro</div>
            <div class="pricing-price">Contact Us</div>
            <ul class="pricing-features">
              <li>‚úÖ Everything in Free</li>
              <li>‚úÖ Unlimited Exports</li>
              <li>‚úÖ PDF Executive Reports</li>
              <li>‚úÖ 20 Watchlist Vendors</li>
              <li>‚úÖ Slack/Teams Alerts</li>
              <li>‚úÖ Priority Email Digest</li>
              <li>‚úÖ Email Support</li>
              <li>‚ùå API Access</li>
            </ul>
            <button class="btn btn-primary" onclick="openQuoteForm('Pro')" style="width: 100%;">Get Quote</button>
          </div>
          
          <!-- Team Tier -->
          <div class="pricing-card">
            <div class="pricing-tier">Team</div>
            <div class="pricing-price">Contact Us</div>
            <ul class="pricing-features">
              <li>‚úÖ Everything in Pro</li>
              <li>‚úÖ Up to 10 Users</li>
              <li>‚úÖ Unlimited Watchlist</li>
              <li>‚úÖ API Access (10K/mo)</li>
              <li>‚úÖ Custom Alerts</li>
              <li>‚úÖ Priority Support</li>
              <li>‚úÖ Onboarding Call</li>
              <li>‚úÖ 10% Consultancy Discount</li>
            </ul>
            <button class="btn btn-primary" onclick="openQuoteForm('Team')" style="width: 100%;">Get Quote</button>
          </div>
          
          <!-- Enterprise Tier -->
          <div class="pricing-card enterprise">
            <div class="pricing-tier">Enterprise</div>
            <div class="pricing-price">Custom</div>
            <ul class="pricing-features">
              <li>‚úÖ Everything in Team</li>
              <li>‚úÖ Unlimited Users</li>
              <li>‚úÖ Unlimited API</li>
              <li>‚úÖ White-label Reports</li>
              <li>‚úÖ Custom Integrations</li>
              <li>‚úÖ Dedicated Support</li>
              <li>‚úÖ SLA Guarantee</li>
              <li>‚úÖ 25% Consultancy Discount</li>
            </ul>
            <button class="btn btn-primary" onclick="openQuoteForm('Enterprise')" style="width: 100%;">Contact Sales</button>
          </div>
        </div>
        
        <!-- Consultancy Services -->
        <div style="border-top: 1px solid var(--border); padding-top: 24px; margin-top: 24px;">
          <h4 style="color: var(--cyan); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L3 7v6c0 5.25 3.75 10.125 9 11.25 5.25-1.125 9-6 9-11.25V7l-9-5z"/>
            </svg>
            Professional Security Services
          </h4>
          <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">
            Beyond the dashboard, CVEPulse offers comprehensive cybersecurity consultancy services. All services are customized to your organization's needs.
          </p>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px;">
            <div class="service-card" onclick="openQuoteForm('VM Assessment')">
              <div class="service-icon">üîç</div>
              <div class="service-info">
                <div class="service-name">Vulnerability Assessment</div>
                <div class="service-desc">Complete infrastructure & application security assessment</div>
              </div>
              <div class="service-arrow">‚Üí</div>
            </div>
            
            <div class="service-card" onclick="openQuoteForm('Zero-Day Response')">
              <div class="service-icon">üö®</div>
              <div class="service-info">
                <div class="service-name">Zero-Day Response</div>
                <div class="service-desc">Emergency incident response & mitigation</div>
              </div>
              <div class="service-arrow">‚Üí</div>
            </div>
            
            <div class="service-card" onclick="openQuoteForm('Threat Intelligence')">
              <div class="service-icon">üéØ</div>
              <div class="service-info">
                <div class="service-name">Threat Intelligence</div>
                <div class="service-desc">Sector-specific threat reports & dark web monitoring</div>
              </div>
              <div class="service-arrow">‚Üí</div>
            </div>
            
            <div class="service-card" onclick="openQuoteForm('Application Threat Modeling')">
              <div class="service-icon">üèóÔ∏è</div>
              <div class="service-info">
                <div class="service-name">Application Threat Modeling</div>
                <div class="service-desc">STRIDE analysis & custom SIEM use cases</div>
              </div>
              <div class="service-arrow">‚Üí</div>
            </div>
            
            <div class="service-card" onclick="openQuoteForm('SOC Monitoring')">
              <div class="service-icon">üëÅÔ∏è</div>
              <div class="service-info">
                <div class="service-name">SOC Monitoring</div>
                <div class="service-desc">24/7 managed detection & response</div>
              </div>
              <div class="service-arrow">‚Üí</div>
            </div>
            
            <div class="service-card" onclick="openQuoteForm('Managed Security')">
              <div class="service-icon">üõ°Ô∏è</div>
              <div class="service-info">
                <div class="service-name">Fully Managed Security</div>
                <div class="service-desc">Complete security program with vCISO advisory</div>
              </div>
              <div class="service-arrow">‚Üí</div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <!-- Quote Form Modal -->
  <div class="modal-overlay" id="quote-modal">
    <div class="modal" style="max-width: 500px;">
      <div class="modal-header">
        <h3>üì© Get a Quote</h3>
        <button class="modal-close" onclick="closeQuoteForm()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div id="quote-service-display" style="background: var(--bg-secondary); padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
          <span style="color: var(--text-muted); font-size: 12px;">Selected:</span>
          <div id="quote-service-name" style="color: var(--cyan); font-weight: 600; font-size: 16px;">Pro Plan</div>
        </div>
        
        <form id="quote-form" onsubmit="submitQuoteForm(event)">
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">Full Name *</label>
            <input type="text" id="quote-name" required placeholder="John Doe" style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">Work Email *</label>
            <input type="email" id="quote-email" required placeholder="john@company.com" style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">Company Name *</label>
            <input type="text" id="quote-company" required placeholder="Acme Corp" style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">Phone Number</label>
            <input type="tel" id="quote-phone" placeholder="+91 98765 43210" style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
          </div>
          
          <div style="margin-bottom: 16px;">
            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">Company Size</label>
            <select id="quote-size" style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
              <option value="">Select...</option>
              <option value="1-10">1-10 employees</option>
              <option value="11-50">11-50 employees</option>
              <option value="51-200">51-200 employees</option>
              <option value="201-500">201-500 employees</option>
              <option value="500+">500+ employees</option>
            </select>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">Tell us about your needs</label>
            <textarea id="quote-message" rows="3" placeholder="Describe your security challenges or requirements..." style="width: 100%; padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px; resize: vertical;"></textarea>
          </div>
          
          <button type="submit" class="btn btn-primary" style="width: 100%; padding: 14px; font-size: 15px;">
            Request Quote ‚Üí
          </button>
          
          <p style="text-align: center; font-size: 11px; color: var(--text-muted); margin-top: 12px;">
            We'll respond within 24 hours. No spam, ever.
          </p>
        </form>
        
        <div id="quote-success" style="display: none; text-align: center; padding: 40px 20px;">
          <div style="font-size: 48px; margin-bottom: 16px;">‚úÖ</div>
          <h4 style="color: var(--low); margin-bottom: 8px;">Request Submitted!</h4>
          <p style="color: var(--text-secondary); font-size: 14px;">We'll get back to you within 24 hours at the email provided.</p>
          <button class="btn btn-secondary" onclick="closeQuoteForm()" style="margin-top: 20px;">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Watchlist Modal -->
  <div class="modal-overlay" id="watchlist-modal">
    <div class="modal">
      <div class="modal-header">
        <h3>üëÅÔ∏è Vendor Watchlist</h3>
        <button class="modal-close" onclick="closeWatchlistModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="notification-section">
          <h4>Track Specific Vendors</h4>
          <p>Add vendors to your watchlist to filter vulnerabilities and get targeted alerts. Only vulnerabilities from your watched vendors will appear when watchlist filter is active.</p>
          
          <div class="input-group">
            <input type="text" id="watchlist-input" placeholder="Enter vendor name (e.g., Microsoft, Cisco, Ivanti)" onkeypress="if(event.key==='Enter')addToWatchlist()" />
            <button class="btn btn-primary" onclick="addToWatchlist()">Add</button>
          </div>
          
          <div id="watchlist-items" style="margin-top: 16px;"></div>
          
          <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border);">
            <h4 style="margin-bottom: 12px;">Popular Vendors</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
              <button class="btn btn-secondary" onclick="quickAddWatchlist('Microsoft')" style="font-size: 12px; padding: 6px 12px;">+ Microsoft</button>
              <button class="btn btn-secondary" onclick="quickAddWatchlist('Cisco')" style="font-size: 12px; padding: 6px 12px;">+ Cisco</button>
              <button class="btn btn-secondary" onclick="quickAddWatchlist('Fortinet')" style="font-size: 12px; padding: 6px 12px;">+ Fortinet</button>
              <button class="btn btn-secondary" onclick="quickAddWatchlist('Ivanti')" style="font-size: 12px; padding: 6px 12px;">+ Ivanti</button>
              <button class="btn btn-secondary" onclick="quickAddWatchlist('Palo Alto Networks')" style="font-size: 12px; padding: 6px 12px;">+ Palo Alto</button>
              <button class="btn btn-secondary" onclick="quickAddWatchlist('VMware')" style="font-size: 12px; padding: 6px 12px;">+ VMware</button>
              <button class="btn btn-secondary" onclick="quickAddWatchlist('Adobe')" style="font-size: 12px; padding: 6px 12px;">+ Adobe</button>
              <button class="btn btn-secondary" onclick="quickAddWatchlist('Apache')" style="font-size: 12px; padding: 6px 12px;">+ Apache</button>
              <button class="btn btn-secondary" onclick="quickAddWatchlist('Citrix')" style="font-size: 12px; padding: 6px 12px;">+ Citrix</button>
              <button class="btn btn-secondary" onclick="quickAddWatchlist('Oracle')" style="font-size: 12px; padding: 6px 12px;">+ Oracle</button>
            </div>
          </div>
        </div>
        
        <!-- API Access Section -->
        <div class="notification-section" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
          <h4>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--cyan)" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            API Access
            <span class="status-badge disconnected" id="api-status">Free Tier</span>
          </h4>
          <p>Access CVEPulse data programmatically. Generate an API key to integrate with your security tools.</p>
          
          <div class="api-key-box" id="api-key-display" style="display: none;">
            <span id="api-key-value"></span>
            <button class="copy-btn" onclick="copyApiKey()">Copy</button>
          </div>
          
          <button class="btn btn-primary" id="generate-api-btn" onclick="generateApiKey()" style="width: 100%; margin-top: 12px;">
            Generate API Key
          </button>
          
          <div style="margin-top: 16px; padding: 12px; background: rgba(34, 211, 238, 0.1); border-radius: 8px;">
            <p style="font-size: 11px; color: var(--cyan); margin: 0 0 8px 0; font-weight: 600;">API Endpoints:</p>
            <code style="font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px;">GET /api/v1/kev - All KEV vulnerabilities</code>
            <code style="font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px;">GET /api/v1/kev/new - New this week</code>
            <code style="font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px;">GET /api/v1/kev/{cveId} - Specific CVE</code>
            <code style="font-size: 11px; color: var(--text-secondary); display: block;">GET /api/v1/watchlist - Your watchlist</code>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Settings Modal -->
  <div class="modal-overlay" id="notification-modal">
    <div class="modal">
      <div class="modal-header">
        <h3>üîî Alert Settings</h3>
        <button class="modal-close" onclick="closeNotificationSettings()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Slack Integration -->
        <div class="notification-section">
          <h4>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="#E01E5A">
              <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/>
            </svg>
            Slack
            <span class="status-badge disconnected" id="slack-status">Not Connected</span>
          </h4>
          <p>Get instant alerts in your Slack channel when new critical vulnerabilities are added to CISA KEV.</p>
          <div class="input-group">
            <input type="text" id="slack-webhook" placeholder="https://hooks.slack.com/services/..." />
            <button class="btn btn-primary" onclick="saveSlackWebhook()">Save</button>
          </div>
          <button class="btn btn-secondary" onclick="testSlackWebhook()" style="width: 100%;">Send Test Alert</button>
          <div class="test-result" id="slack-test-result"></div>
          <p style="margin-top: 12px;">
            <a href="https://api.slack.com/messaging/webhooks" target="_blank" class="help-link">üìñ How to create a Slack Webhook ‚Üí</a>
          </p>
        </div>

        <!-- Microsoft Teams Integration -->
        <div class="notification-section">
          <h4>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="#6264A7">
              <path d="M20.625 8.5h-6.5a.875.875 0 0 0-.875.875v6.5c0 .483.392.875.875.875h6.5a.875.875 0 0 0 .875-.875v-6.5a.875.875 0 0 0-.875-.875zM17.5 7.5a2 2 0 1 0 0-4 2 2 0 0 0 0 4zM10 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM2.5 10.5h9a.5.5 0 0 1 .5.5v7a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-7a.5.5 0 0 1 .5-.5z"/>
            </svg>
            Microsoft Teams
            <span class="status-badge disconnected" id="teams-status">Not Connected</span>
          </h4>
          <p>Receive vulnerability alerts directly in your Microsoft Teams channel.</p>
          <div class="input-group">
            <input type="text" id="teams-webhook" placeholder="https://outlook.office.com/webhook/..." />
            <button class="btn btn-primary" onclick="saveTeamsWebhook()">Save</button>
          </div>
          <button class="btn btn-secondary" onclick="testTeamsWebhook()" style="width: 100%;">Send Test Alert</button>
          <div class="test-result" id="teams-test-result"></div>
          <p style="margin-top: 12px;">
            <a href="https://learn.microsoft.com/en-us/microsoftteams/platform/webhooks-and-connectors/how-to/add-incoming-webhook" target="_blank" class="help-link">üìñ How to create a Teams Webhook ‚Üí</a>
          </p>
        </div>

        <!-- Email Subscription -->
        <div class="notification-section">
          <h4>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--cyan)" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
            Email Alerts
            <span class="status-badge disconnected" id="email-status">Not Subscribed</span>
          </h4>
          <p>Get daily digest of critical vulnerabilities delivered to your inbox.</p>
          <div class="input-group">
            <input type="email" id="email-input" placeholder="your@email.com" />
            <button class="btn btn-primary" onclick="subscribeEmail()">Subscribe</button>
          </div>
          <div class="test-result" id="email-result"></div>
        </div>

        <!-- Browser Push Notifications -->
        <div class="notification-section">
          <h4>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FF6B6B" stroke-width="2">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
              <line x1="12" y1="2" x2="12" y2="4"/>
            </svg>
            Browser Notifications
            <span class="status-badge disconnected" id="push-status">Not Enabled</span>
          </h4>
          <p>Get instant browser alerts when critical vulnerabilities are detected - works even when this tab is in the background!</p>
          <button class="btn btn-primary" id="push-enable-btn" onclick="enablePushNotifications()" style="width: 100%;">
            Enable Browser Notifications
          </button>
          <button class="btn btn-secondary" id="push-test-btn" onclick="testPushNotification()" style="width: 100%; margin-top: 10px; display: none;">
            Send Test Notification
          </button>
          <div class="test-result" id="push-test-result"></div>
        </div>

        <!-- Alert Preferences -->
        <div class="notification-section">
          <h4>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--cyan)" stroke-width="2">
              <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
            Alert Preferences
          </h4>
          <p>Choose what triggers an alert:</p>
          <div style="display: flex; flex-direction: column; gap: 10px;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="pref-zero-day" checked style="width: 18px; height: 18px; accent-color: var(--cyan);">
              <span style="font-size: 13px;">Zero-Day vulnerabilities (no patch available)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="pref-new-kev" checked style="width: 18px; height: 18px; accent-color: var(--cyan);">
              <span style="font-size: 13px;">New KEV additions</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="pref-ransomware" checked style="width: 18px; height: 18px; accent-color: var(--cyan);">
              <span style="font-size: 13px;">Ransomware-linked vulnerabilities</span>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="pref-high-epss" style="width: 18px; height: 18px; accent-color: var(--cyan);">
              <span style="font-size: 13px;">High EPSS score (‚â•70%)</span>
            </label>
          </div>
          <button class="btn btn-primary" onclick="savePreferences()" style="width: 100%; margin-top: 16px;">Save Preferences</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <div class="footer-inner">
        <div class="footer-sources">
          Data: 
          <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog" target="_blank" style="color: var(--cyan); text-decoration: none;">CISA KEV</a> ‚Ä¢ 
          <a href="https://www.first.org/epss/" target="_blank" style="color: var(--cyan); text-decoration: none;">FIRST EPSS</a> ‚Ä¢ 
          Auto-refreshes every 15 minutes
        </div>
        <div class="footer-brand">¬© 2025 CVEPulse.com ‚Äî Intelligence for Security Leaders</div>
      </div>
    </div>
  </footer>

  <script>
    // ===========================================
    // VENDOR PATCH URLS - Direct links to vendor security pages
    // ===========================================
    const VENDOR_PATCH_URLS = {
      'Ivanti': 'https://forums.ivanti.com/s/article/KB-CVE-2025-0282',
      'Fortinet': 'https://www.fortiguard.com/psirt',
      'Microsoft': 'https://msrc.microsoft.com/update-guide',
      'Palo Alto Networks': 'https://security.paloaltonetworks.com/',
      'Cisco': 'https://sec.cloudapps.cisco.com/security/center/publicationListing.x',
      'Adobe': 'https://helpx.adobe.com/security.html',
      'Apache': 'https://www.apache.org/security/',
      'VMware': 'https://www.vmware.com/security/advisories.html',
      'Citrix': 'https://support.citrix.com/securitybulletins',
      'BeyondTrust': 'https://www.beyondtrust.com/trust-center/security-advisories',
      'Cleo': 'https://support.cleo.com/hc/en-us',
      'ConnectWise': 'https://www.connectwise.com/company/trust/security-bulletins',
      'JetBrains': 'https://www.jetbrains.com/privacy-security/',
      'Atlassian': 'https://www.atlassian.com/trust/security/advisories',
      'Oracle': 'https://www.oracle.com/security-alerts/',
      'SAP': 'https://support.sap.com/en/my-support/knowledge-base/security-notes-news.html',
      'Zoom': 'https://explore.zoom.us/en/trust/security/security-bulletin/',
      'SonicWall': 'https://psirt.global.sonicwall.com/vuln-list',
      'F5': 'https://my.f5.com/manage/s/article/K00000000',
      'Zyxel': 'https://www.zyxel.com/global/en/support/security-advisories'
    };

    // ===========================================
    // SAMPLE DATA with patch availability & zero-day status
    // ===========================================
    const SAMPLE_KEV_DATA = {
      catalogVersion: "2025.01.09",
      dateReleased: new Date().toISOString(),
      count: 1247,
      vulnerabilities: [
        // ZERO-DAYS WITHOUT PATCHES (Most Critical)
        {
          cveID: "CVE-2025-0282",
          vendorProject: "Ivanti",
          product: "Connect Secure and Policy Secure",
          vulnerabilityName: "Ivanti Connect Secure Stack-Based Buffer Overflow Vulnerability",
          shortDescription: "Stack-based buffer overflow allowing unauthenticated remote code execution. Actively exploited by UNC5337 since December 2024.",
          dateAdded: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() + 20 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Unknown",
          // Extended fields
          isZeroDay: true,
          patchAvailable: false,
          patchETA: "2025-01-15",
          mitigation: "Apply Ivanti's XML mitigation file. Block external access to /api/v1/totp/user-backup-code. Monitor for webshell artifacts in /tmp.",
          threatActors: ["UNC5337"]
        },
        {
          cveID: "CVE-2025-0283",
          vendorProject: "Ivanti",
          product: "Connect Secure",
          vulnerabilityName: "Ivanti Connect Secure Privilege Escalation Vulnerability",
          shortDescription: "Privilege escalation allowing local authenticated attackers to gain root access. Chained with CVE-2025-0282 in active attacks.",
          dateAdded: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() + 20 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Unknown",
          isZeroDay: true,
          patchAvailable: false,
          patchETA: "2025-01-15",
          mitigation: "Same mitigations as CVE-2025-0282. Restrict local admin access. Consider taking appliance offline if not business critical.",
          threatActors: ["UNC5337"]
        },
        // PATCHED BUT NEW (Apply Patch Immediately)
        {
          cveID: "CVE-2024-55591",
          vendorProject: "Fortinet",
          product: "FortiOS and FortiProxy",
          vulnerabilityName: "Fortinet FortiOS Authentication Bypass Vulnerability",
          shortDescription: "Authentication bypass via Node.js websocket module allowing unauthenticated attackers to gain super-admin privileges.",
          dateAdded: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() + 19 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Unknown",
          isZeroDay: true,
          patchAvailable: true,
          patchVersion: "FortiOS 7.0.17, 7.2.9, or 7.4.5",
          mitigation: "If unable to patch: Disable HTTP/HTTPS administrative interface or limit source IP access to trusted hosts only.",
          threatActors: ["Mass scanning observed"]
        },
        {
          cveID: "CVE-2024-12356",
          vendorProject: "BeyondTrust",
          product: "Privileged Remote Access and Remote Support",
          vulnerabilityName: "BeyondTrust Command Injection Vulnerability",
          shortDescription: "Command injection allowing unauthenticated remote attackers to execute OS commands as site user.",
          dateAdded: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() + 16 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Known",
          isZeroDay: false,
          patchAvailable: true,
          patchVersion: "BT24-10-ONPREM1 or BT24-10-ONPREM2",
          mitigation: "Restrict network access to BeyondTrust appliances. Monitor for suspicious process execution.",
          threatActors: ["Scattered Spider"]
        },
        {
          cveID: "CVE-2024-50623",
          vendorProject: "Cleo",
          product: "Harmony, VLTrader, and LexiCom",
          vulnerabilityName: "Cleo Unrestricted File Upload Vulnerability",
          shortDescription: "Unrestricted file upload allowing unauthenticated attackers to execute arbitrary code. Mass exploited by Clop ransomware.",
          dateAdded: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() + 13 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Known",
          isZeroDay: false,
          patchAvailable: true,
          patchVersion: "5.8.0.24 or later",
          mitigation: "Disable autorun features. Review uploaded files. Block known Clop C2 indicators.",
          threatActors: ["Clop Ransomware Gang"]
        },
        {
          cveID: "CVE-2024-49112",
          vendorProject: "Microsoft",
          product: "Windows LDAP",
          vulnerabilityName: "Microsoft Windows LDAP Remote Code Execution Vulnerability",
          shortDescription: "RCE vulnerability (LDAPNightmare) that could allow attackers to compromise Domain Controllers via crafted LDAP calls.",
          dateAdded: new Date(Date.now() - 12 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() + 9 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Unknown",
          isZeroDay: false,
          patchAvailable: true,
          patchVersion: "December 2024 Patch Tuesday (KB5048667)",
          mitigation: "Ensure DCs are not directly exposed to internet. Monitor for unusual LDAP traffic patterns.",
          threatActors: []
        },
        {
          cveID: "CVE-2024-53677",
          vendorProject: "Apache",
          product: "Struts",
          vulnerabilityName: "Apache Struts Path Traversal Vulnerability",
          shortDescription: "Path traversal allowing file upload to arbitrary locations, potentially leading to remote code execution.",
          dateAdded: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() + 6 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Unknown",
          isZeroDay: false,
          patchAvailable: true,
          patchVersion: "Struts 6.4.0 or later",
          mitigation: "Review and restrict file upload configurations. Implement WAF rules for path traversal patterns.",
          threatActors: []
        },
        // OVERDUE
        {
          cveID: "CVE-2024-21887",
          vendorProject: "Ivanti",
          product: "Connect Secure and Policy Secure",
          vulnerabilityName: "Ivanti Connect Secure Command Injection Vulnerability",
          shortDescription: "Command injection in web component allowing authenticated attackers to execute arbitrary commands. Heavily exploited.",
          dateAdded: new Date(Date.now() - 45 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Known",
          isZeroDay: false,
          patchAvailable: true,
          patchVersion: "Available since January 2024",
          mitigation: "OVERDUE - Patch immediately or isolate system.",
          threatActors: ["Multiple nation-state actors", "Ransomware groups"]
        },
        {
          cveID: "CVE-2024-3400",
          vendorProject: "Palo Alto Networks",
          product: "PAN-OS GlobalProtect",
          vulnerabilityName: "Palo Alto Networks PAN-OS Command Injection Vulnerability",
          shortDescription: "Command injection in GlobalProtect allowing unauthenticated RCE with root privileges. Massively exploited in April 2024.",
          dateAdded: new Date(Date.now() - 60 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Known",
          isZeroDay: false,
          patchAvailable: true,
          patchVersion: "PAN-OS 10.2.9-h1, 11.0.4-h1, 11.1.2-h3",
          mitigation: "OVERDUE - Patch immediately. If compromised, perform full forensic investigation.",
          threatActors: ["UTA0218", "Multiple threat actors"]
        },
        {
          cveID: "CVE-2024-1709",
          vendorProject: "ConnectWise",
          product: "ScreenConnect",
          vulnerabilityName: "ConnectWise ScreenConnect Authentication Bypass Vulnerability",
          shortDescription: "Authentication bypass allowing attackers to gain administrative access and deploy ransomware.",
          dateAdded: new Date(Date.now() - 50 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Known",
          isZeroDay: false,
          patchAvailable: true,
          patchVersion: "ScreenConnect 23.9.8 or later",
          mitigation: "Restrict access to ScreenConnect. Enable MFA. Monitor for unauthorized sessions.",
          threatActors: ["Black Basta", "LockBit affiliates"]
        },
        {
          cveID: "CVE-2024-38112",
          vendorProject: "Microsoft",
          product: "Windows MSHTML Platform",
          vulnerabilityName: "Microsoft Windows MSHTML Spoofing Vulnerability",
          shortDescription: "Spoofing vulnerability exploited via malicious internet shortcut files to execute code.",
          dateAdded: new Date(Date.now() - 25 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          dueDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
          knownRansomwareCampaignUse: "Unknown",
          isZeroDay: false,
          patchAvailable: true,
          patchVersion: "July 2024 Patch Tuesday",
          mitigation: "Block .url files at email gateway. User awareness training on suspicious files.",
          threatActors: ["Void Banshee APT"]
        }
      ]
    };

    const SAMPLE_EPSS_DATA = {
      "CVE-2025-0282": { epss: 0.94, percentile: 0.99 },
      "CVE-2024-55591": { epss: 0.91, percentile: 0.98 },
      "CVE-2025-0283": { epss: 0.67, percentile: 0.92 },
      "CVE-2024-12356": { epss: 0.89, percentile: 0.97 },
      "CVE-2024-50623": { epss: 0.93, percentile: 0.99 },
      "CVE-2024-49112": { epss: 0.85, percentile: 0.96 },
      "CVE-2024-53677": { epss: 0.78, percentile: 0.94 },
      "CVE-2024-21887": { epss: 0.97, percentile: 0.99 },
      "CVE-2024-3400": { epss: 0.96, percentile: 0.99 },
      "CVE-2024-1709": { epss: 0.94, percentile: 0.99 },
      "CVE-2024-38112": { epss: 0.72, percentile: 0.93 }
    };

    // ===========================================
    // STATE
    // ===========================================
    let kevData = null;
    let epssData = {};
    let activeFilter = 'new-week';
    let isLoading = false;
    let isLiveData = false;

    // ===========================================
    // API FUNCTIONS
    // ===========================================
    
    async function fetchKEV() {
      try {
        const response = await fetch('https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json');
        if (response.ok) {
          isLiveData = true;
          const data = await response.json();
          // Enrich with our extended fields for known CVEs
          data.vulnerabilities = data.vulnerabilities.map(v => {
            const sampleMatch = SAMPLE_KEV_DATA.vulnerabilities.find(s => s.cveID === v.cveID);
            return sampleMatch ? { ...v, ...sampleMatch } : v;
          });
          return data;
        }
      } catch (e) {
        console.log('Direct CISA fetch failed');
      }

      try {
        const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json');
        const response = await fetch(proxyUrl);
        if (response.ok) {
          isLiveData = true;
          const data = await response.json();
          data.vulnerabilities = data.vulnerabilities.map(v => {
            const sampleMatch = SAMPLE_KEV_DATA.vulnerabilities.find(s => s.cveID === v.cveID);
            return sampleMatch ? { ...v, ...sampleMatch } : v;
          });
          return data;
        }
      } catch (e) {
        console.log('Proxy fetch failed');
      }

      isLiveData = false;
      return SAMPLE_KEV_DATA;
    }

    async function fetchEPSS(cveIds) {
      if (!isLiveData) return SAMPLE_EPSS_DATA;

      const scores = {};
      for (let i = 0; i < cveIds.length; i += 30) {
        const chunk = cveIds.slice(i, i + 30);
        try {
          const response = await fetch(`https://api.first.org/data/v1/epss?cve=${chunk.join(',')}`);
          if (response.ok) {
            const data = await response.json();
            (data.data || []).forEach(item => {
              scores[item.cve] = { epss: parseFloat(item.epss), percentile: parseFloat(item.percentile) };
            });
          }
          await new Promise(r => setTimeout(r, 100));
        } catch (e) {}
      }
      return { ...SAMPLE_EPSS_DATA, ...scores };
    }

    async function fetchAllData() {
      if (isLoading) return;
      
      isLoading = true;
      showLoading(true);

      try {
        kevData = await fetchKEV();
        
        const recentVulns = kevData.vulnerabilities.filter(v => daysSince(v.dateAdded) <= 90).slice(0, 100);
        const cveIds = recentVulns.map(v => v.cveID);
        epssData = await fetchEPSS(cveIds);

        const sourceEl = document.getElementById('data-source');
        if (isLiveData) {
          sourceEl.textContent = 'LIVE DATA';
          sourceEl.className = 'data-source live';
          document.getElementById('catalog-info').innerHTML = `Live CISA KEV ‚Ä¢ ${kevData.count} vulnerabilities tracked <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog" target="_blank" style="color: var(--cyan); text-decoration: none; font-size: 12px;">[View Full Catalog]</a>`;
        } else {
          sourceEl.textContent = 'DEMO MODE';
          sourceEl.className = 'data-source demo';
          document.getElementById('catalog-info').innerHTML = `Demo mode ‚Ä¢ Showing realistic sample data <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog" target="_blank" style="color: var(--cyan); text-decoration: none; font-size: 12px;">[View CISA KEV]</a>`;
        }
        
        document.getElementById('update-time').textContent = new Date().toLocaleTimeString();

        renderCISOActions();
        renderStats();
        applyFilters();
        showMainContent();
        
        // Check for new vulnerabilities and send alerts
        const processed = getProcessedVulns();
        checkForNewVulnerabilities(processed.newMonth);
      } catch (error) {
        console.error('Fetch error:', error);
        kevData = SAMPLE_KEV_DATA;
        epssData = SAMPLE_EPSS_DATA;
        isLiveData = false;
        
        document.getElementById('data-source').textContent = 'DEMO MODE';
        document.getElementById('data-source').className = 'data-source demo';
        document.getElementById('catalog-info').innerHTML = `Demo mode ‚Ä¢ Showing realistic sample data <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog" target="_blank" style="color: var(--cyan); text-decoration: none; font-size: 12px;">[View CISA KEV]</a>`;
        document.getElementById('update-time').textContent = new Date().toLocaleTimeString();
        
        renderCISOActions();
        renderStats();
        applyFilters();
        showMainContent();
      } finally {
        isLoading = false;
        showLoading(false);
      }
    }

    // ===========================================
    // UTILITY FUNCTIONS
    // ===========================================
    
    function daysSince(dateStr) {
      if (!dateStr) return 999;
      return Math.floor((new Date() - new Date(dateStr)) / (1000 * 60 * 60 * 24));
    }

    function daysUntil(dateStr) {
      if (!dateStr) return 999;
      return Math.ceil((new Date(dateStr) - new Date()) / (1000 * 60 * 60 * 24));
    }

    function formatShortDate(dateStr) {
      if (!dateStr) return 'N/A';
      return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    function showLoading(show) {
      document.getElementById('loading-state').style.display = show ? 'flex' : 'none';
      document.getElementById('refresh-btn').disabled = show;
      const svg = document.getElementById('refresh-btn').querySelector('svg');
      svg.style.animation = show ? 'spin 1s linear infinite' : 'none';
    }

    function showMainContent() {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
    }

    function getVendorPatchUrl(vendor, cveId) {
      const baseUrl = VENDOR_PATCH_URLS[vendor];
      if (baseUrl) return baseUrl;
      return `https://www.google.com/search?q=${cveId}+${encodeURIComponent(vendor)}+security+advisory+patch`;
    }

    // ===========================================
    // RENDER FUNCTIONS
    // ===========================================
    
    function getProcessedVulns() {
      if (!kevData?.vulnerabilities) return {};
      
      const vulns = kevData.vulnerabilities.map(v => ({
        ...v,
        daysAdded: daysSince(v.dateAdded),
        daysDue: daysUntil(v.dueDate),
        epss: epssData[v.cveID]?.epss || 0
      }));

      vulns.sort((a, b) => a.daysAdded - b.daysAdded);

      return {
        newWeek: vulns.filter(v => v.daysAdded <= 7),
        newMonth: vulns.filter(v => v.daysAdded <= 30),
        noPatch: vulns.filter(v => v.isZeroDay && v.patchAvailable === false),
        urgent: vulns.filter(v => v.daysDue >= 0 && v.daysDue <= 7),
        overdue: vulns.filter(v => v.daysDue < 0),
        highEpss: vulns.filter(v => v.epss >= 0.7),
        ransomware: vulns.filter(v => v.knownRansomwareCampaignUse === 'Known'),
        all: vulns
      };
    }

    function renderCISOActions() {
      const processed = getProcessedVulns();
      
      const actions = [];
      
      // P1: Zero-days without patches
      if (processed.noPatch.length > 0) {
        const vendors = [...new Set(processed.noPatch.map(v => v.vendorProject))].join(', ');
        actions.push({
          priority: 'P1',
          text: `BLOCK/ISOLATE: ${processed.noPatch.length} zero-day(s) without patches`,
          context: `Affected: ${vendors}. No patches available - apply mitigations immediately.`,
          pClass: 'p1'
        });
      }
      
      // P1: Ransomware-linked with upcoming deadline
      const ransomwareUrgent = processed.ransomware.filter(v => v.daysDue <= 7 && v.daysDue >= 0);
      if (ransomwareUrgent.length > 0) {
        actions.push({
          priority: 'P1',
          text: `PATCH: ${ransomwareUrgent.length} ransomware-linked CVE(s) due within 7 days`,
          context: `Active ransomware campaigns targeting these vulnerabilities.`,
          pClass: 'p1'
        });
      }
      
      // P2: Overdue items
      if (processed.overdue.length > 0) {
        actions.push({
          priority: 'P2',
          text: `ESCALATE: ${processed.overdue.length} overdue KEV(s) past CISA deadline`,
          context: `Federal compliance at risk. Immediate patching or risk acceptance required.`,
          pClass: 'p2'
        });
      }
      
      // P2: New this week with patches
      const newWithPatch = processed.newWeek.filter(v => v.patchAvailable !== false);
      if (newWithPatch.length > 0) {
        actions.push({
          priority: 'P2',
          text: `PATCH: ${newWithPatch.length} new KEV(s) added this week`,
          context: `Recently added to CISA KEV. Start patching cycle now.`,
          pClass: 'p2'
        });
      }
      
      // P3: High EPSS
      const highEpssNotNew = processed.highEpss.filter(v => v.daysAdded > 7);
      if (highEpssNotNew.length > 0) {
        actions.push({
          priority: 'P3',
          text: `MONITOR: ${highEpssNotNew.length} high EPSS score CVE(s)`,
          context: `EPSS ‚â•70% indicates high exploitation probability. Prioritize in backlog.`,
          pClass: 'p3'
        });
      }

      document.getElementById('ciso-actions').innerHTML = actions.length > 0 
        ? actions.map(a => `
            <div class="ciso-action-item ${a.pClass}">
              <div class="ciso-action-priority ${a.pClass}">${a.priority} ‚Äî URGENT</div>
              <div class="ciso-action-text">${a.text}</div>
              <div class="ciso-action-context">${a.context}</div>
            </div>
          `).join('')
        : '<div style="color: var(--low); text-align: center; padding: 20px;">‚úì No critical actions required at this time</div>';
    }

    function renderStats() {
      const processed = getProcessedVulns();
      
      const stats = [
        { value: processed.noPatch.length, label: 'Zero-Day (No Patch)', color: 'var(--critical)', highlight: processed.noPatch.length > 0 },
        { value: processed.newWeek.length, label: 'New This Week', color: 'var(--high)', highlight: false },
        { value: processed.overdue.length, label: 'Overdue', color: 'var(--critical)', highlight: processed.overdue.length > 0 },
        { value: processed.urgent.length, label: 'Due Within 7 Days', color: 'var(--high)', highlight: false },
        { value: processed.highEpss.length, label: 'High EPSS (‚â•70%)', color: 'var(--cyan)', highlight: false },
        { value: processed.ransomware.length, label: 'Ransomware Linked', color: '#c084fc', highlight: false }
      ];

      document.getElementById('stats-grid').innerHTML = stats.map(s => `
        <div class="stat-card ${s.highlight ? 'highlight' : ''}">
          <div class="stat-value" style="color: ${s.color}">${s.value}</div>
          <div class="stat-label">${s.label}</div>
        </div>
      `).join('');
    }

    function setFilter(filter) {
      activeFilter = filter;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
      });
      applyFilters();
    }

    function applyFilters() {
      const processed = getProcessedVulns();
      const searchTerm = document.getElementById('search-input').value.toLowerCase();

      let vulns;
      switch (activeFilter) {
        case 'new-week': vulns = processed.newWeek; break;
        case 'new-month': vulns = processed.newMonth; break;
        case 'no-patch': vulns = processed.noPatch; break;
        case 'urgent': vulns = processed.urgent; break;
        case 'overdue': vulns = processed.overdue; break;
        case 'high-epss': vulns = processed.highEpss; break;
        case 'ransomware': vulns = processed.ransomware; break;
        case 'watchlist': 
          vulns = processed.all.filter(v => 
            watchlist.some(w => v.vendorProject.toLowerCase().includes(w.toLowerCase()))
          );
          break;
        default: vulns = processed.newMonth;
      }

      if (searchTerm) {
        vulns = vulns.filter(v =>
          v.cveID.toLowerCase().includes(searchTerm) ||
          v.vendorProject.toLowerCase().includes(searchTerm) ||
          v.product.toLowerCase().includes(searchTerm)
        );
      }

      document.getElementById('results-count').textContent = `Showing ${vulns.length} vulnerabilities`;
      renderVulnList(vulns);
    }

    function renderVulnList(vulns) {
      if (vulns.length === 0) {
        document.getElementById('vuln-list').innerHTML = `
          <div class="empty-state">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            <p style="font-size: 16px;">No vulnerabilities match your criteria</p>
          </div>
        `;
        return;
      }

      document.getElementById('vuln-list').innerHTML = vulns.slice(0, 50).map(v => {
        const isNew = v.daysAdded <= 7;
        const isOverdue = v.daysDue < 0;
        const isUrgent = v.daysDue >= 0 && v.daysDue <= 7;
        const isZeroDay = v.isZeroDay === true;
        const hasPatch = v.patchAvailable !== false;
        const severityClass = (isZeroDay && !hasPatch) ? 'critical' : isOverdue ? 'critical' : isUrgent ? 'high' : 'medium';

        // Build badges
        const badges = [];
        if (isNew) badges.push('<span class="badge badge-new">NEW</span>');
        if (isZeroDay) badges.push('<span class="badge badge-zero-day">Zero-Day</span>');
        if (!hasPatch) badges.push('<span class="badge badge-no-patch">No Patch</span>');
        badges.push('<span class="badge badge-kev">KEV</span>');
        if (hasPatch) badges.push('<span class="badge badge-patch">Patch Available</span>');
        if (v.epss >= 0.7) badges.push(`<span class="badge badge-epss">EPSS ${(v.epss * 100).toFixed(0)}%</span>`);
        if (v.knownRansomwareCampaignUse === 'Known') badges.push('<span class="badge badge-ransomware">Ransomware</span>');

        // Determine action type
        let actionType, actionIcon, actionTitle, actionText, actionButton;
        
        if (isZeroDay && !hasPatch) {
          // Zero-day without patch - BLOCK/ISOLATE
          actionType = 'block';
          actionIcon = 'üõë';
          actionTitle = 'IMMEDIATE ACTION: Block / Isolate';
          actionText = v.mitigation || 'No patch available. Isolate affected systems from network. Apply vendor mitigations if available.';
          actionButton = `<button class="action-btn block" onclick="window.open('${getVendorPatchUrl(v.vendorProject, v.cveID)}', '_blank')">View Mitigations</button>`;
        } else if (hasPatch) {
          // Patch available - PATCH
          actionType = 'patch';
          actionIcon = '‚úÖ';
          actionTitle = 'ACTION: Apply Patch';
          actionText = v.patchVersion ? `Update to: ${v.patchVersion}` : 'Patch available from vendor.';
          actionButton = `<a href="${getVendorPatchUrl(v.vendorProject, v.cveID)}" target="_blank" class="action-btn patch">Get Patch</a>`;
        } else {
          // Other - MITIGATE
          actionType = 'mitigate';
          actionIcon = '‚ö†Ô∏è';
          actionTitle = 'ACTION: Apply Mitigations';
          actionText = v.mitigation || 'Apply vendor-recommended mitigations until patch is available.';
          actionButton = `<button class="action-btn mitigate" onclick="window.open('${getVendorPatchUrl(v.vendorProject, v.cveID)}', '_blank')">View Mitigations</button>`;
        }

        // Get vendor security page URL
        const vendorSecurityUrl = VENDOR_PATCH_URLS[v.vendorProject] || `https://www.google.com/search?q=${encodeURIComponent(v.vendorProject)}+security+advisories`;
        
        return `
          <div class="vuln-card ${severityClass}">
            <div class="vuln-header">
              <a href="https://nvd.nist.gov/vuln/detail/${v.cveID}" target="_blank" class="vuln-cve" title="View on NVD">
                ${v.cveID}
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"/>
                </svg>
              </a>
              <div class="badges">${badges.join('')}</div>
            </div>
            <div class="vuln-product">
              <a href="${vendorSecurityUrl}" target="_blank" style="color: var(--text-primary); text-decoration: none; border-bottom: 1px dashed var(--text-muted);" title="View ${v.vendorProject} Security Advisories">${v.vendorProject}</a>
              ‚Äî
              <a href="https://www.google.com/search?q=${encodeURIComponent(v.cveID + ' ' + v.product)}" target="_blank" style="color: var(--text-secondary); text-decoration: none; border-bottom: 1px dashed var(--text-muted);" title="Search for ${v.product} vulnerability info">${v.product}</a>
            </div>
            <div class="vuln-desc">${v.shortDescription || v.vulnerabilityName}</div>
            <div class="vuln-meta">
              <div class="meta-item">
                <span class="meta-label">Added to KEV</span>
                <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog?search_api_fulltext=${v.cveID}" target="_blank" style="text-decoration: none;">
                  <span class="meta-value" style="border-bottom: 1px dashed var(--text-muted);" title="View on CISA KEV">${formatShortDate(v.dateAdded)}</span>
                </a>
              </div>
              <div class="meta-item">
                <span class="meta-label">Due Date</span>
                <span class="meta-value ${isOverdue ? 'critical' : isUrgent ? 'high' : 'good'}">
                  ${isOverdue ? Math.abs(v.daysDue) + 'd OVERDUE' : v.daysDue + 'd remaining'}
                </span>
              </div>
              <div class="meta-item">
                <span class="meta-label">EPSS Score</span>
                <a href="https://api.first.org/data/v1/epss?cve=${v.cveID}" target="_blank" style="text-decoration: none;" title="View EPSS data on FIRST">
                  <span class="meta-value ${v.epss >= 0.7 ? 'critical' : ''}" style="border-bottom: 1px dashed var(--text-muted);">${(v.epss * 100).toFixed(1)}%</span>
                </a>
              </div>
              ${v.threatActors && v.threatActors.length > 0 ? `
                <div class="meta-item">
                  <span class="meta-label">Threat Actor</span>
                  <a href="https://www.google.com/search?q=${encodeURIComponent(v.threatActors[0])}+threat+actor+APT" target="_blank" style="text-decoration: none;" title="Search for threat actor intel">
                    <span class="meta-value" style="color: #c084fc; border-bottom: 1px dashed #c084fc;">${v.threatActors[0]}</span>
                  </a>
                </div>
              ` : ''}
            </div>
            <div class="action-guidance">
              <div class="action-guidance-icon ${actionType}">${actionIcon}</div>
              <div class="action-guidance-content">
                <div class="action-guidance-title ${actionType}">${actionTitle}</div>
                <div class="action-guidance-text">${actionText}</div>
              </div>
            </div>
            <div class="vuln-actions">
              ${actionButton}
              <a href="https://nvd.nist.gov/vuln/detail/${v.cveID}" target="_blank" class="action-btn secondary">NVD Details</a>
              <button class="action-btn secondary" onclick="window.open('https://www.google.com/search?q=${v.cveID}+IOC+indicators', '_blank')">Find IOCs</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function exportCSV() {
      if (!kevData?.vulnerabilities) return;

      const processed = getProcessedVulns();
      let vulns;
      switch (activeFilter) {
        case 'new-week': vulns = processed.newWeek; break;
        case 'new-month': vulns = processed.newMonth; break;
        case 'no-patch': vulns = processed.noPatch; break;
        case 'urgent': vulns = processed.urgent; break;
        case 'overdue': vulns = processed.overdue; break;
        case 'ransomware': vulns = processed.ransomware; break;
        default: vulns = processed.newMonth;
      }

      const headers = ['CVE ID', 'Vendor', 'Product', 'Date Added', 'Due Date', 'Days Remaining', 'EPSS', 'Zero-Day', 'Patch Available', 'Ransomware', 'Action'];
      const rows = vulns.map(v => [
        v.cveID,
        v.vendorProject,
        v.product,
        v.dateAdded,
        v.dueDate,
        v.daysDue,
        ((epssData[v.cveID]?.epss || 0) * 100).toFixed(1) + '%',
        v.isZeroDay ? 'Yes' : 'No',
        v.patchAvailable !== false ? 'Yes' : 'No',
        v.knownRansomwareCampaignUse,
        v.isZeroDay && v.patchAvailable === false ? 'BLOCK/ISOLATE' : v.patchAvailable !== false ? 'PATCH' : 'MITIGATE'
      ]);

      const csv = [headers, ...rows].map(r => r.map(c => `"${c}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `cvepulse-kev-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // ===========================================
    // PHASE 3: PRICING & QUOTE SYSTEM
    // ===========================================
    
    let selectedService = '';
    
    function openPricingModal() {
      document.getElementById('pricing-modal').classList.add('active');
    }
    
    function closePricingModal() {
      document.getElementById('pricing-modal').classList.remove('active');
    }
    
    function openQuoteForm(service) {
      selectedService = service;
      document.getElementById('quote-service-name').textContent = service;
      document.getElementById('quote-form').style.display = 'block';
      document.getElementById('quote-success').style.display = 'none';
      document.getElementById('quote-modal').classList.add('active');
      closePricingModal();
    }
    
    function closeQuoteForm() {
      document.getElementById('quote-modal').classList.remove('active');
    }
    
    async function submitQuoteForm(event) {
      event.preventDefault();
      
      const formData = {
        service: selectedService,
        name: document.getElementById('quote-name').value,
        email: document.getElementById('quote-email').value,
        company: document.getElementById('quote-company').value,
        phone: document.getElementById('quote-phone').value,
        size: document.getElementById('quote-size').value,
        message: document.getElementById('quote-message').value,
        timestamp: new Date().toISOString()
      };
      
      // Store locally for now (in production, send to Firebase/email)
      const leads = JSON.parse(localStorage.getItem('cvepulse_leads') || '[]');
      leads.push(formData);
      localStorage.setItem('cvepulse_leads', JSON.stringify(leads));
      
      // Try to send via backend if available
      try {
        await fetch(`${API_BASE_URL}/quote`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
      } catch (e) {
        // Backend not available, data saved locally
        console.log('Quote saved locally, backend not available');
      }
      
      // Show success
      document.getElementById('quote-form').style.display = 'none';
      document.getElementById('quote-success').style.display = 'block';
      
      // Reset form
      document.getElementById('quote-form').reset();
    }
    
    // Close modals on outside click
    document.getElementById('pricing-modal')?.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) closePricingModal();
    });
    
    document.getElementById('quote-modal')?.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) closeQuoteForm();
    });

    // ===========================================
    // PHASE 3: WATCHLIST MANAGEMENT
    // ===========================================
    
    let watchlist = JSON.parse(localStorage.getItem('cvepulse_watchlist') || '[]');
    
    function openWatchlistModal() {
      document.getElementById('watchlist-modal').classList.add('active');
      renderWatchlistItems();
    }
    
    function closeWatchlistModal() {
      document.getElementById('watchlist-modal').classList.remove('active');
    }
    
    // Close modal on outside click
    document.getElementById('watchlist-modal')?.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) {
        closeWatchlistModal();
      }
    });
    
    function addToWatchlist() {
      const input = document.getElementById('watchlist-input');
      const vendor = input.value.trim();
      
      if (!vendor) return;
      
      if (!watchlist.includes(vendor)) {
        watchlist.push(vendor);
        localStorage.setItem('cvepulse_watchlist', JSON.stringify(watchlist));
        renderWatchlistItems();
        updateWatchlistUI();
        applyFilters();
      }
      
      input.value = '';
    }
    
    function quickAddWatchlist(vendor) {
      if (!watchlist.includes(vendor)) {
        watchlist.push(vendor);
        localStorage.setItem('cvepulse_watchlist', JSON.stringify(watchlist));
        renderWatchlistItems();
        updateWatchlistUI();
        applyFilters();
      }
    }
    
    function removeFromWatchlist(vendor) {
      watchlist = watchlist.filter(v => v !== vendor);
      localStorage.setItem('cvepulse_watchlist', JSON.stringify(watchlist));
      renderWatchlistItems();
      updateWatchlistUI();
      applyFilters();
    }
    
    function renderWatchlistItems() {
      const container = document.getElementById('watchlist-items');
      
      if (watchlist.length === 0) {
        container.innerHTML = '<p style="color: var(--text-muted); font-size: 13px;">No vendors in watchlist. Add vendors above or click popular vendors below.</p>';
        return;
      }
      
      container.innerHTML = watchlist.map(vendor => `
        <div class="watchlist-tag" style="margin-bottom: 8px;">
          <span>üëÅÔ∏è ${vendor}</span>
          <span class="remove" onclick="removeFromWatchlist('${vendor}')">&times;</span>
        </div>
      `).join('');
    }
    
    function updateWatchlistUI() {
      const filterBtn = document.getElementById('watchlist-filter-btn');
      const countSpan = document.getElementById('watchlist-count');
      const tagsContainer = document.getElementById('watchlist-tags-container');
      const tagsDiv = document.getElementById('watchlist-tags');
      
      if (watchlist.length > 0) {
        filterBtn.style.display = 'inline-flex';
        countSpan.textContent = watchlist.length;
        tagsContainer.style.display = 'flex';
        tagsDiv.innerHTML = watchlist.map(v => `
          <span class="watchlist-tag">
            ${v}
            <span class="remove" onclick="removeFromWatchlist('${v}')">&times;</span>
          </span>
        `).join('');
      } else {
        filterBtn.style.display = 'none';
        tagsContainer.style.display = 'none';
      }
    }
    
    // ===========================================
    // PHASE 3: EXPORT MENU
    // ===========================================
    
    function toggleExportMenu() {
      const menu = document.getElementById('export-menu');
      menu.classList.toggle('show');
    }
    
    // Close export menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.export-dropdown')) {
        document.getElementById('export-menu')?.classList.remove('show');
      }
    });
    
    function exportJSON() {
      const processed = getProcessedVulns();
      let vulns;
      
      switch (activeFilter) {
        case 'new-week': vulns = processed.newWeek; break;
        case 'new-month': vulns = processed.newMonth; break;
        case 'no-patch': vulns = processed.noPatch; break;
        case 'urgent': vulns = processed.urgent; break;
        case 'overdue': vulns = processed.overdue; break;
        case 'ransomware': vulns = processed.ransomware; break;
        case 'watchlist': vulns = processed.all.filter(v => watchlist.some(w => v.vendorProject.toLowerCase().includes(w.toLowerCase()))); break;
        default: vulns = processed.newMonth;
      }
      
      const exportData = {
        metadata: {
          exportDate: new Date().toISOString(),
          source: 'CVEPulse',
          filter: activeFilter,
          totalCount: vulns.length
        },
        vulnerabilities: vulns.map(v => ({
          cveId: v.cveID,
          vendor: v.vendorProject,
          product: v.product,
          description: v.shortDescription || v.vulnerabilityName,
          dateAdded: v.dateAdded,
          dueDate: v.dueDate,
          daysRemaining: v.daysDue,
          epssScore: v.epss,
          isZeroDay: v.isZeroDay || false,
          patchAvailable: v.patchAvailable !== false,
          ransomwareLinked: v.knownRansomwareCampaignUse === 'Known',
          action: v.isZeroDay && v.patchAvailable === false ? 'BLOCK_ISOLATE' : 'PATCH',
          nvdUrl: `https://nvd.nist.gov/vuln/detail/${v.cveID}`
        }))
      };
      
      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `cvepulse-${activeFilter}-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      document.getElementById('export-menu').classList.remove('show');
    }
    
    // ===========================================
    // PHASE 3: PDF EXECUTIVE REPORT
    // ===========================================
    
    function generatePDFReport() {
      document.getElementById('export-menu').classList.remove('show');
      
      const processed = getProcessedVulns();
      
      // Create printable HTML report
      const reportHTML = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>CVEPulse Executive Security Brief - ${new Date().toLocaleDateString()}</title>
          <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { 
              font-family: 'Segoe UI', Arial, sans-serif; 
              padding: 40px; 
              color: #1a1a2e;
              line-height: 1.6;
            }
            .header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding-bottom: 20px;
              border-bottom: 3px solid #22d3ee;
              margin-bottom: 30px;
            }
            .logo { font-size: 28px; font-weight: 800; color: #0f172a; }
            .logo span { color: #22d3ee; }
            .date { color: #64748b; font-size: 14px; }
            .classification {
              background: #fef2f2;
              border: 2px solid #ef4444;
              color: #991b1b;
              padding: 8px 16px;
              font-weight: 700;
              text-transform: uppercase;
              font-size: 12px;
              border-radius: 4px;
            }
            h1 { font-size: 24px; margin-bottom: 8px; }
            h2 { 
              font-size: 18px; 
              color: #0f172a; 
              margin: 30px 0 15px 0;
              padding-bottom: 8px;
              border-bottom: 2px solid #e5e7eb;
            }
            .summary-grid {
              display: grid;
              grid-template-columns: repeat(4, 1fr);
              gap: 16px;
              margin: 20px 0;
            }
            .summary-card {
              background: #f8fafc;
              border: 1px solid #e5e7eb;
              border-radius: 8px;
              padding: 16px;
              text-align: center;
            }
            .summary-card.critical { border-left: 4px solid #ef4444; }
            .summary-card.high { border-left: 4px solid #f97316; }
            .summary-card.medium { border-left: 4px solid #eab308; }
            .summary-card.info { border-left: 4px solid #22d3ee; }
            .summary-value { font-size: 32px; font-weight: 800; }
            .summary-value.critical { color: #ef4444; }
            .summary-value.high { color: #f97316; }
            .summary-value.medium { color: #eab308; }
            .summary-value.info { color: #22d3ee; }
            .summary-label { font-size: 11px; color: #64748b; text-transform: uppercase; }
            .action-list {
              background: #f0fdf4;
              border: 1px solid #86efac;
              border-radius: 8px;
              padding: 20px;
              margin: 20px 0;
            }
            .action-list h3 {
              color: #166534;
              font-size: 14px;
              margin-bottom: 12px;
            }
            .action-item {
              display: flex;
              align-items: flex-start;
              gap: 12px;
              padding: 10px 0;
              border-bottom: 1px solid #dcfce7;
            }
            .action-item:last-child { border-bottom: none; }
            .action-priority {
              background: #166534;
              color: white;
              padding: 2px 8px;
              border-radius: 4px;
              font-size: 10px;
              font-weight: 700;
            }
            .action-priority.p1 { background: #ef4444; }
            .action-priority.p2 { background: #f97316; }
            .action-priority.p3 { background: #eab308; color: #1a1a2e; }
            table {
              width: 100%;
              border-collapse: collapse;
              margin: 16px 0;
              font-size: 12px;
            }
            th {
              background: #0f172a;
              color: white;
              padding: 12px 8px;
              text-align: left;
              font-weight: 600;
            }
            td {
              padding: 10px 8px;
              border-bottom: 1px solid #e5e7eb;
              vertical-align: top;
            }
            tr:hover { background: #f8fafc; }
            .badge {
              display: inline-block;
              padding: 2px 6px;
              border-radius: 4px;
              font-size: 9px;
              font-weight: 700;
              text-transform: uppercase;
            }
            .badge-critical { background: #fef2f2; color: #ef4444; border: 1px solid #fecaca; }
            .badge-high { background: #fff7ed; color: #f97316; border: 1px solid #fed7aa; }
            .badge-ransomware { background: #f5f3ff; color: #7c3aed; border: 1px solid #ddd6fe; }
            .footer {
              margin-top: 40px;
              padding-top: 20px;
              border-top: 1px solid #e5e7eb;
              font-size: 11px;
              color: #64748b;
              text-align: center;
            }
            @media print {
              body { padding: 20px; }
              .no-print { display: none; }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <div>
              <div class="logo">CVE<span>Pulse</span></div>
              <div class="date">Executive Security Brief ‚Ä¢ ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
            </div>
            <div class="classification">CONFIDENTIAL</div>
          </div>
          
          <h1>Vulnerability Intelligence Summary</h1>
          <p style="color: #64748b; margin-bottom: 20px;">Active threats from CISA Known Exploited Vulnerabilities catalog requiring immediate attention.</p>
          
          <div class="summary-grid">
            <div class="summary-card critical">
              <div class="summary-value critical">${processed.noPatch?.length || 0}</div>
              <div class="summary-label">Zero-Day (No Patch)</div>
            </div>
            <div class="summary-card high">
              <div class="summary-value high">${processed.overdue?.length || 0}</div>
              <div class="summary-label">Overdue</div>
            </div>
            <div class="summary-card medium">
              <div class="summary-value medium">${processed.newWeek?.length || 0}</div>
              <div class="summary-label">New This Week</div>
            </div>
            <div class="summary-card info">
              <div class="summary-value info">${processed.ransomware?.length || 0}</div>
              <div class="summary-label">Ransomware Linked</div>
            </div>
          </div>
          
          <div class="action-list">
            <h3>üéØ Priority Actions Required</h3>
            ${processed.noPatch?.length > 0 ? `
              <div class="action-item">
                <span class="action-priority p1">P1</span>
                <div>
                  <strong>BLOCK/ISOLATE:</strong> ${processed.noPatch.length} zero-day vulnerabilit${processed.noPatch.length === 1 ? 'y' : 'ies'} without patches
                  <div style="font-size: 11px; color: #64748b; margin-top: 4px;">${processed.noPatch.map(v => v.cveID).join(', ')}</div>
                </div>
              </div>
            ` : ''}
            ${processed.overdue?.length > 0 ? `
              <div class="action-item">
                <span class="action-priority p1">P1</span>
                <div>
                  <strong>ESCALATE:</strong> ${processed.overdue.length} overdue KEV${processed.overdue.length === 1 ? '' : 's'} past CISA deadline
                  <div style="font-size: 11px; color: #64748b; margin-top: 4px;">Federal compliance at risk</div>
                </div>
              </div>
            ` : ''}
            ${processed.ransomware?.filter(v => v.daysAdded <= 7).length > 0 ? `
              <div class="action-item">
                <span class="action-priority p2">P2</span>
                <div>
                  <strong>PATCH IMMEDIATELY:</strong> ${processed.ransomware.filter(v => v.daysAdded <= 7).length} new ransomware-linked CVE${processed.ransomware.filter(v => v.daysAdded <= 7).length === 1 ? '' : 's'}
                  <div style="font-size: 11px; color: #64748b; margin-top: 4px;">Active ransomware campaigns targeting these vulnerabilities</div>
                </div>
              </div>
            ` : ''}
            ${processed.newWeek?.length > 0 ? `
              <div class="action-item">
                <span class="action-priority p3">P3</span>
                <div>
                  <strong>START PATCHING:</strong> ${processed.newWeek.length} new KEV${processed.newWeek.length === 1 ? '' : 's'} added this week
                  <div style="font-size: 11px; color: #64748b; margin-top: 4px;">Begin remediation within 21 days per CISA directive</div>
                </div>
              </div>
            ` : ''}
          </div>
          
          <h2>üö® Critical Vulnerabilities - Immediate Action Required</h2>
          <table>
            <thead>
              <tr>
                <th>CVE ID</th>
                <th>Vendor / Product</th>
                <th>Status</th>
                <th>EPSS</th>
                <th>Due Date</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              ${[...(processed.noPatch || []), ...(processed.overdue || [])].slice(0, 10).map(v => `
                <tr>
                  <td><strong>${v.cveID}</strong></td>
                  <td>${v.vendorProject}<br><span style="color: #64748b; font-size: 11px;">${v.product}</span></td>
                  <td>
                    ${v.isZeroDay && v.patchAvailable === false ? '<span class="badge badge-critical">Zero-Day</span>' : ''}
                    ${v.daysDue < 0 ? '<span class="badge badge-high">Overdue</span>' : ''}
                    ${v.knownRansomwareCampaignUse === 'Known' ? '<span class="badge badge-ransomware">Ransomware</span>' : ''}
                  </td>
                  <td>${((v.epss || 0) * 100).toFixed(0)}%</td>
                  <td>${v.daysDue < 0 ? `<span style="color: #ef4444; font-weight: 600;">${Math.abs(v.daysDue)}d OVERDUE</span>` : `${v.daysDue}d`}</td>
                  <td><strong>${v.isZeroDay && v.patchAvailable === false ? 'BLOCK' : 'PATCH'}</strong></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          
          ${processed.newWeek?.length > 0 ? `
            <h2>üìÖ New This Week</h2>
            <table>
              <thead>
                <tr>
                  <th>CVE ID</th>
                  <th>Vendor / Product</th>
                  <th>Description</th>
                  <th>EPSS</th>
                  <th>Deadline</th>
                </tr>
              </thead>
              <tbody>
                ${processed.newWeek.slice(0, 10).map(v => `
                  <tr>
                    <td><strong>${v.cveID}</strong></td>
                    <td>${v.vendorProject}<br><span style="color: #64748b; font-size: 11px;">${v.product}</span></td>
                    <td style="max-width: 300px;">${(v.shortDescription || v.vulnerabilityName).substring(0, 150)}...</td>
                    <td>${((v.epss || 0) * 100).toFixed(0)}%</td>
                    <td>${v.dueDate}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          ` : ''}
          
          <div class="footer">
            <p>Generated by CVEPulse ‚Ä¢ www.cvepulse.com</p>
            <p>Data sources: CISA Known Exploited Vulnerabilities (KEV) Catalog, FIRST EPSS</p>
            <p style="margin-top: 8px;">This report is confidential and intended for internal security team use only.</p>
          </div>
          
          <div class="no-print" style="margin-top: 30px; text-align: center;">
            <button onclick="window.print()" style="background: #22d3ee; color: #0f172a; border: none; padding: 12px 32px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 14px;">
              üñ®Ô∏è Print / Save as PDF
            </button>
            <p style="margin-top: 12px; font-size: 12px; color: #64748b;">Use your browser's print function and select "Save as PDF"</p>
          </div>
        </body>
        </html>
      `;
      
      // Open in new window for printing
      const printWindow = window.open('', '_blank');
      printWindow.document.write(reportHTML);
      printWindow.document.close();
    }
    
    // ===========================================
    // PHASE 3: API KEY MANAGEMENT
    // ===========================================
    
    function generateApiKey() {
      // Generate a simple API key (in production, this would come from backend)
      const key = 'cvp_' + Array.from(crypto.getRandomValues(new Uint8Array(24)))
        .map(b => b.toString(16).padStart(2, '0')).join('');
      
      localStorage.setItem('cvepulse_api_key', key);
      
      document.getElementById('api-key-display').style.display = 'block';
      document.getElementById('api-key-value').textContent = key;
      document.getElementById('generate-api-btn').textContent = 'Regenerate API Key';
      document.getElementById('api-status').textContent = 'Active';
      document.getElementById('api-status').className = 'status-badge connected';
    }
    
    function copyApiKey() {
      const key = document.getElementById('api-key-value').textContent;
      navigator.clipboard.writeText(key).then(() => {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy', 2000);
      });
    }
    
    function loadApiKey() {
      const key = localStorage.getItem('cvepulse_api_key');
      if (key) {
        document.getElementById('api-key-display').style.display = 'block';
        document.getElementById('api-key-value').textContent = key;
        document.getElementById('generate-api-btn').textContent = 'Regenerate API Key';
        document.getElementById('api-status').textContent = 'Active';
        document.getElementById('api-status').className = 'status-badge connected';
      }
    }

    // ===========================================
    // FIREBASE BACKEND CONFIGURATION
    // ===========================================
    
    // Update this URL after deploying Firebase Functions
    const API_BASE_URL = 'https://YOUR_PROJECT.cloudfunctions.net/api';
    // For local development: 'http://localhost:5001/YOUR_PROJECT/us-central1/api'
    
    // ===========================================
    // EMAIL SUBSCRIPTION
    // ===========================================
    
    async function subscribeEmail() {
      const emailInput = document.getElementById('email-input');
      const resultEl = document.getElementById('email-result');
      const email = emailInput.value.trim();
      
      if (!email || !email.includes('@')) {
        resultEl.textContent = '‚ùå Please enter a valid email address';
        resultEl.className = 'test-result error';
        return;
      }
      
      // Get current preferences
      const prefs = {
        zeroDay: document.getElementById('pref-zero-day').checked,
        newKev: document.getElementById('pref-new-kev').checked,
        ransomware: document.getElementById('pref-ransomware').checked,
        highEpss: document.getElementById('pref-high-epss').checked
      };
      
      resultEl.textContent = '‚è≥ Subscribing...';
      resultEl.className = 'test-result';
      resultEl.style.display = 'block';
      resultEl.style.background = 'rgba(34, 211, 238, 0.1)';
      resultEl.style.borderColor = 'rgba(34, 211, 238, 0.3)';
      resultEl.style.color = 'var(--cyan)';
      
      try {
        const response = await fetch(`${API_BASE_URL}/subscribe`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, preferences: prefs })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          resultEl.textContent = '‚úÖ ' + data.message;
          resultEl.className = 'test-result success';
          localStorage.setItem('cvepulse_email_subscribed', email);
          document.getElementById('email-status').textContent = 'Pending Verification';
          document.getElementById('email-status').className = 'status-badge';
          document.getElementById('email-status').style.background = 'rgba(234, 179, 8, 0.2)';
          document.getElementById('email-status').style.color = 'var(--medium)';
        } else {
          resultEl.textContent = '‚ùå ' + (data.error || 'Subscription failed');
          resultEl.className = 'test-result error';
        }
      } catch (error) {
        console.error('Subscribe error:', error);
        resultEl.innerHTML = `
          ‚ö†Ô∏è <strong>Backend not configured.</strong><br>
          Deploy Firebase Functions first. See README for instructions.
        `;
        resultEl.className = 'test-result';
        resultEl.style.background = 'rgba(234, 179, 8, 0.1)';
        resultEl.style.borderColor = 'rgba(234, 179, 8, 0.3)';
        resultEl.style.color = 'var(--medium)';
      }
    }
    
    async function unsubscribeEmail() {
      const email = localStorage.getItem('cvepulse_email_subscribed');
      if (!email) return;
      
      try {
        await fetch(`${API_BASE_URL}/unsubscribe`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        
        localStorage.removeItem('cvepulse_email_subscribed');
        document.getElementById('email-status').textContent = 'Not Subscribed';
        document.getElementById('email-status').className = 'status-badge disconnected';
      } catch (error) {
        console.error('Unsubscribe error:', error);
      }
    }
    
    // Check email subscription status on load
    function checkEmailStatus() {
      const email = localStorage.getItem('cvepulse_email_subscribed');
      if (email) {
        document.getElementById('email-input').value = email;
        document.getElementById('email-status').textContent = 'Subscribed';
        document.getElementById('email-status').className = 'status-badge connected';
      }
    }
    
    // ===========================================
    // WEBHOOK PROXY (via Firebase)
    // ===========================================
    
    async function sendSlackViaBackend(webhookUrl, message) {
      try {
        const response = await fetch(`${API_BASE_URL}/webhook/slack`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ webhookUrl, message })
        });
        return response.ok;
      } catch (error) {
        console.error('Slack proxy error:', error);
        return false;
      }
    }
    
    async function sendTeamsViaBackend(webhookUrl, message) {
      try {
        const response = await fetch(`${API_BASE_URL}/webhook/teams`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ webhookUrl, message })
        });
        return response.ok;
      } catch (error) {
        console.error('Teams proxy error:', error);
        return false;
      }
    }

    // ===========================================
    // BROWSER PUSH NOTIFICATIONS
    // ===========================================
    
    let pushNotificationsEnabled = false;
    
    function checkPushSupport() {
      return 'Notification' in window;
    }
    
    function updatePushUI() {
      const statusEl = document.getElementById('push-status');
      const enableBtn = document.getElementById('push-enable-btn');
      const testBtn = document.getElementById('push-test-btn');
      
      if (!checkPushSupport()) {
        statusEl.textContent = 'Not Supported';
        statusEl.className = 'status-badge disconnected';
        enableBtn.textContent = 'Browser Not Supported';
        enableBtn.disabled = true;
        return;
      }
      
      if (Notification.permission === 'granted') {
        pushNotificationsEnabled = true;
        statusEl.textContent = 'Enabled';
        statusEl.className = 'status-badge connected';
        enableBtn.textContent = '‚úì Notifications Enabled';
        enableBtn.disabled = true;
        enableBtn.style.background = 'var(--low)';
        enableBtn.style.color = '#000';
        testBtn.style.display = 'block';
      } else if (Notification.permission === 'denied') {
        statusEl.textContent = 'Blocked';
        statusEl.className = 'status-badge disconnected';
        statusEl.style.background = 'rgba(239, 68, 68, 0.2)';
        statusEl.style.color = 'var(--critical)';
        enableBtn.textContent = 'Notifications Blocked - Check Browser Settings';
        enableBtn.disabled = true;
      } else {
        statusEl.textContent = 'Not Enabled';
        statusEl.className = 'status-badge disconnected';
        enableBtn.textContent = 'Enable Browser Notifications';
        enableBtn.disabled = false;
      }
    }
    
    async function enablePushNotifications() {
      if (!checkPushSupport()) {
        alert('Your browser does not support notifications');
        return;
      }
      
      try {
        const permission = await Notification.requestPermission();
        
        if (permission === 'granted') {
          pushNotificationsEnabled = true;
          localStorage.setItem('cvepulse_push_enabled', 'true');
          updatePushUI();
          
          // Show welcome notification
          new Notification('CVEPulse Alerts Enabled! üõ°Ô∏è', {
            body: 'You will now receive alerts for critical vulnerabilities.',
            icon: 'https://www.cvepulse.com/favicon.ico',
            badge: 'https://www.cvepulse.com/favicon.ico',
            tag: 'cvepulse-welcome',
            requireInteraction: false
          });
        } else {
          updatePushUI();
        }
      } catch (error) {
        console.error('Push notification error:', error);
        alert('Failed to enable notifications. Please check your browser settings.');
      }
    }
    
    function testPushNotification() {
      if (Notification.permission !== 'granted') {
        alert('Please enable notifications first');
        return;
      }
      
      const resultEl = document.getElementById('push-test-result');
      
      // Create test notification
      const notification = new Notification('üö® CVEPulse Test Alert', {
        body: 'CVE-2025-0282 - Ivanti Connect Secure\nZero-Day: No patch available\nAction: Block/Isolate immediately',
        icon: 'https://www.cvepulse.com/favicon.ico',
        badge: 'https://www.cvepulse.com/favicon.ico',
        tag: 'cvepulse-test',
        requireInteraction: true,
        actions: [
          { action: 'view', title: 'View Details' },
          { action: 'dismiss', title: 'Dismiss' }
        ]
      });
      
      notification.onclick = function() {
        window.focus();
        notification.close();
      };
      
      resultEl.textContent = '‚úÖ Test notification sent! Check your system notifications.';
      resultEl.className = 'test-result success';
    }
    
    // Send actual vulnerability alert
    function sendPushAlert(vuln) {
      if (Notification.permission !== 'granted') return;
      
      const prefs = JSON.parse(localStorage.getItem('cvepulse_alert_prefs') || '{}');
      const isZeroDay = vuln.isZeroDay && vuln.patchAvailable === false;
      const isRansomware = vuln.knownRansomwareCampaignUse === 'Known';
      const isHighEpss = (vuln.epss || 0) >= 0.7;
      
      // Check preferences
      if (isZeroDay && prefs.zeroDay === false) return;
      if (!isZeroDay && !isRansomware && prefs.newKev === false) return;
      if (isRansomware && prefs.ransomware === false) return;
      if (isHighEpss && !isZeroDay && !isRansomware && prefs.highEpss === false) return;
      
      const emoji = isZeroDay ? 'üö®' : isRansomware ? 'üíÄ' : '‚ö†Ô∏è';
      const severity = isZeroDay ? 'ZERO-DAY' : isRansomware ? 'RANSOMWARE' : 'NEW KEV';
      const action = isZeroDay ? 'Block/Isolate immediately' : 'Patch required';
      
      const notification = new Notification(`${emoji} ${severity}: ${vuln.cveID}`, {
        body: `${vuln.vendorProject} - ${vuln.product}\n${action}\nEPSS: ${((vuln.epss || 0) * 100).toFixed(0)}%`,
        icon: 'https://www.cvepulse.com/favicon.ico',
        badge: 'https://www.cvepulse.com/favicon.ico',
        tag: `cvepulse-${vuln.cveID}`,
        requireInteraction: isZeroDay || isRansomware,
        data: { cveId: vuln.cveID, url: `https://nvd.nist.gov/vuln/detail/${vuln.cveID}` }
      });
      
      notification.onclick = function() {
        window.open(this.data.url, '_blank');
        notification.close();
      };
    }
    
    // Check for new vulnerabilities and send alerts
    let lastKnownCVEs = new Set();
    
    function checkForNewVulnerabilities(vulns) {
      if (lastKnownCVEs.size === 0) {
        // First load - just populate the set, don't alert
        vulns.forEach(v => lastKnownCVEs.add(v.cveID));
        return;
      }
      
      const newVulns = vulns.filter(v => !lastKnownCVEs.has(v.cveID));
      
      if (newVulns.length > 0 && pushNotificationsEnabled) {
        // Send alerts for new vulnerabilities
        newVulns.forEach(vuln => {
          sendPushAlert(vuln);
          lastKnownCVEs.add(vuln.cveID);
        });
        
        // Also try Slack/Teams if configured
        sendWebhookAlerts(newVulns);
      }
    }
    
    // Send alerts to configured webhooks
    async function sendWebhookAlerts(vulns) {
      const slackWebhook = localStorage.getItem('cvepulse_slack_webhook');
      const teamsWebhook = localStorage.getItem('cvepulse_teams_webhook');
      
      for (const vuln of vulns) {
        // Slack - try backend proxy first, then direct
        if (slackWebhook) {
          const message = formatSlackAlert(vuln);
          const success = await sendSlackViaBackend(slackWebhook, message);
          if (!success) {
            // Fallback to direct (will likely fail due to CORS)
            try {
              await fetch(slackWebhook, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(message)
              });
            } catch (e) {
              console.log('Slack webhook failed:', e);
            }
          }
        }
        
        // Teams - try backend proxy first, then direct
        if (teamsWebhook) {
          const message = formatTeamsAlert(vuln);
          const success = await sendTeamsViaBackend(teamsWebhook, message);
          if (!success) {
            // Fallback to direct (will likely fail due to CORS)
            try {
              await fetch(teamsWebhook, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(message)
              });
            } catch (e) {
              console.log('Teams webhook failed:', e);
            }
          }
        }
      }
    }

    // ===========================================
    // NOTIFICATION SYSTEM
    // ===========================================
    
    function openNotificationSettings() {
      document.getElementById('notification-modal').classList.add('active');
      loadNotificationSettings();
    }
    
    function closeNotificationSettings() {
      document.getElementById('notification-modal').classList.remove('active');
    }
    
    // Close modal on outside click
    document.getElementById('notification-modal')?.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) {
        closeNotificationSettings();
      }
    });
    
    function loadNotificationSettings() {
      // Load Slack webhook
      const slackWebhook = localStorage.getItem('cvepulse_slack_webhook');
      if (slackWebhook) {
        document.getElementById('slack-webhook').value = slackWebhook;
        document.getElementById('slack-status').textContent = 'Connected';
        document.getElementById('slack-status').className = 'status-badge connected';
      }
      
      // Load Teams webhook
      const teamsWebhook = localStorage.getItem('cvepulse_teams_webhook');
      if (teamsWebhook) {
        document.getElementById('teams-webhook').value = teamsWebhook;
        document.getElementById('teams-status').textContent = 'Connected';
        document.getElementById('teams-status').className = 'status-badge connected';
      }
      
      // Load email subscription status
      checkEmailStatus();
      
      // Load preferences
      const prefs = JSON.parse(localStorage.getItem('cvepulse_alert_prefs') || '{}');
      document.getElementById('pref-zero-day').checked = prefs.zeroDay !== false;
      document.getElementById('pref-new-kev').checked = prefs.newKev !== false;
      document.getElementById('pref-ransomware').checked = prefs.ransomware !== false;
      document.getElementById('pref-high-epss').checked = prefs.highEpss === true;
      
      // Check push notification status
      updatePushUI();
    }
    
    function saveSlackWebhook() {
      const webhook = document.getElementById('slack-webhook').value.trim();
      if (!webhook) {
        localStorage.removeItem('cvepulse_slack_webhook');
        document.getElementById('slack-status').textContent = 'Not Connected';
        document.getElementById('slack-status').className = 'status-badge disconnected';
        return;
      }
      
      if (!webhook.startsWith('https://hooks.slack.com/')) {
        alert('Please enter a valid Slack webhook URL');
        return;
      }
      
      localStorage.setItem('cvepulse_slack_webhook', webhook);
      document.getElementById('slack-status').textContent = 'Connected';
      document.getElementById('slack-status').className = 'status-badge connected';
    }
    
    function saveTeamsWebhook() {
      const webhook = document.getElementById('teams-webhook').value.trim();
      if (!webhook) {
        localStorage.removeItem('cvepulse_teams_webhook');
        document.getElementById('teams-status').textContent = 'Not Connected';
        document.getElementById('teams-status').className = 'status-badge disconnected';
        return;
      }
      
      if (!webhook.includes('webhook.office.com') && !webhook.includes('outlook.office.com')) {
        alert('Please enter a valid Microsoft Teams webhook URL');
        return;
      }
      
      localStorage.setItem('cvepulse_teams_webhook', webhook);
      document.getElementById('teams-status').textContent = 'Connected';
      document.getElementById('teams-status').className = 'status-badge connected';
    }
    
    function savePreferences() {
      const prefs = {
        zeroDay: document.getElementById('pref-zero-day').checked,
        newKev: document.getElementById('pref-new-kev').checked,
        ransomware: document.getElementById('pref-ransomware').checked,
        highEpss: document.getElementById('pref-high-epss').checked
      };
      localStorage.setItem('cvepulse_alert_prefs', JSON.stringify(prefs));
      alert('Preferences saved!');
    }
    
    async function testSlackWebhook() {
      const webhook = document.getElementById('slack-webhook').value.trim();
      const resultEl = document.getElementById('slack-test-result');
      
      if (!webhook) {
        resultEl.textContent = '‚ùå Please enter a webhook URL first';
        resultEl.className = 'test-result error';
        return;
      }
      
      // Create test message
      const testMessage = {
        blocks: [
          {
            type: "header",
            text: {
              type: "plain_text",
              text: "üîî CVEPulse Test Alert",
              emoji: true
            }
          },
          {
            type: "section",
            text: {
              type: "mrkdwn",
              text: "‚úÖ *Your Slack integration is working!*\n\nYou will receive alerts when new critical vulnerabilities are added to CISA KEV."
            }
          },
          {
            type: "divider"
          },
          {
            type: "section",
            fields: [
              {
                type: "mrkdwn",
                text: "*Alert Types Enabled:*"
              },
              {
                type: "mrkdwn",
                text: "Zero-Days, New KEVs, Ransomware"
              }
            ]
          },
          {
            type: "context",
            elements: [
              {
                type: "mrkdwn",
                text: "Sent from <https://www.cvepulse.com|CVEPulse> Emergency Intelligence Dashboard"
              }
            ]
          }
        ]
      };
      
      try {
        // Note: Direct webhook calls from browser may be blocked by CORS
        // In production, this should go through your backend
        resultEl.textContent = '‚è≥ Sending test message...';
        resultEl.className = 'test-result';
        resultEl.style.display = 'block';
        resultEl.style.background = 'rgba(34, 211, 238, 0.1)';
        resultEl.style.borderColor = 'rgba(34, 211, 238, 0.3)';
        resultEl.style.color = 'var(--cyan)';
        
        // Try to send via a CORS proxy (for demo purposes)
        // In production, use your own backend
        const response = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent(webhook), {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(testMessage)
        });
        
        if (response.ok) {
          resultEl.textContent = '‚úÖ Test message sent! Check your Slack channel.';
          resultEl.className = 'test-result success';
        } else {
          throw new Error('Failed to send');
        }
      } catch (error) {
        // CORS will likely block this - show manual test instructions
        resultEl.innerHTML = `
          ‚ö†Ô∏è <strong>Browser security blocks direct webhook calls.</strong><br><br>
          To test manually, run this in your terminal:<br>
          <code style="display: block; background: rgba(0,0,0,0.3); padding: 8px; margin-top: 8px; border-radius: 4px; font-size: 11px; word-break: break-all;">
          curl -X POST -H "Content-Type: application/json" -d '{"text":"CVEPulse test alert!"}' "${webhook}"
          </code>
        `;
        resultEl.className = 'test-result';
        resultEl.style.display = 'block';
        resultEl.style.background = 'rgba(234, 179, 8, 0.1)';
        resultEl.style.borderColor = 'rgba(234, 179, 8, 0.3)';
        resultEl.style.color = 'var(--medium)';
      }
    }
    
    async function testTeamsWebhook() {
      const webhook = document.getElementById('teams-webhook').value.trim();
      const resultEl = document.getElementById('teams-test-result');
      
      if (!webhook) {
        resultEl.textContent = '‚ùå Please enter a webhook URL first';
        resultEl.className = 'test-result error';
        return;
      }
      
      // Teams Adaptive Card format
      const testMessage = {
        "@type": "MessageCard",
        "@context": "http://schema.org/extensions",
        "themeColor": "22d3ee",
        "summary": "CVEPulse Test Alert",
        "sections": [{
          "activityTitle": "üîî CVEPulse Test Alert",
          "activitySubtitle": "Your Microsoft Teams integration is working!",
          "facts": [{
            "name": "Status",
            "value": "‚úÖ Connected"
          }, {
            "name": "Alert Types",
            "value": "Zero-Days, New KEVs, Ransomware"
          }],
          "markdown": true
        }],
        "potentialAction": [{
          "@type": "OpenUri",
          "name": "Open CVEPulse Dashboard",
          "targets": [{
            "os": "default",
            "uri": "https://www.cvepulse.com"
          }]
        }]
      };
      
      resultEl.innerHTML = `
        ‚ö†Ô∏è <strong>Browser security blocks direct webhook calls.</strong><br><br>
        To test manually, run this in your terminal:<br>
        <code style="display: block; background: rgba(0,0,0,0.3); padding: 8px; margin-top: 8px; border-radius: 4px; font-size: 11px; word-break: break-all;">
        curl -X POST -H "Content-Type: application/json" -d '{"text":"CVEPulse test alert!"}' "${webhook}"
        </code>
      `;
      resultEl.className = 'test-result';
      resultEl.style.display = 'block';
      resultEl.style.background = 'rgba(234, 179, 8, 0.1)';
      resultEl.style.borderColor = 'rgba(234, 179, 8, 0.3)';
      resultEl.style.color = 'var(--medium)';
    }
    
    // Function to send actual alerts (called when new KEVs detected)
    function formatSlackAlert(vuln) {
      const isZeroDay = vuln.isZeroDay && vuln.patchAvailable === false;
      const emoji = isZeroDay ? 'üö®' : vuln.knownRansomwareCampaignUse === 'Known' ? 'üíÄ' : '‚ö†Ô∏è';
      const severity = isZeroDay ? 'ZERO-DAY' : vuln.knownRansomwareCampaignUse === 'Known' ? 'RANSOMWARE' : 'NEW KEV';
      
      return {
        blocks: [
          {
            type: "header",
            text: {
              type: "plain_text",
              text: `${emoji} ${severity}: ${vuln.cveID}`,
              emoji: true
            }
          },
          {
            type: "section",
            text: {
              type: "mrkdwn",
              text: `*${vuln.vendorProject} - ${vuln.product}*\n${vuln.shortDescription || vuln.vulnerabilityName}`
            }
          },
          {
            type: "section",
            fields: [
              { type: "mrkdwn", text: `*EPSS Score:*\n${((vuln.epss || 0) * 100).toFixed(1)}%` },
              { type: "mrkdwn", text: `*Due Date:*\n${vuln.dueDate}` },
              { type: "mrkdwn", text: `*Patch:*\n${vuln.patchAvailable !== false ? '‚úÖ Available' : '‚ùå Not Available'}` },
              { type: "mrkdwn", text: `*Action:*\n${isZeroDay ? 'BLOCK/ISOLATE' : 'PATCH NOW'}` }
            ]
          },
          {
            type: "actions",
            elements: [
              {
                type: "button",
                text: { type: "plain_text", text: "View on NVD", emoji: true },
                url: `https://nvd.nist.gov/vuln/detail/${vuln.cveID}`
              },
              {
                type: "button",
                text: { type: "plain_text", text: "Open Dashboard", emoji: true },
                url: "https://www.cvepulse.com"
              }
            ]
          }
        ]
      };
    }
    
    function formatTeamsAlert(vuln) {
      const isZeroDay = vuln.isZeroDay && vuln.patchAvailable === false;
      const emoji = isZeroDay ? 'üö®' : vuln.knownRansomwareCampaignUse === 'Known' ? 'üíÄ' : '‚ö†Ô∏è';
      const severity = isZeroDay ? 'ZERO-DAY' : vuln.knownRansomwareCampaignUse === 'Known' ? 'RANSOMWARE' : 'NEW KEV';
      const color = isZeroDay ? 'FF0000' : vuln.knownRansomwareCampaignUse === 'Known' ? 'FF6600' : '22d3ee';
      
      return {
        "@type": "MessageCard",
        "@context": "http://schema.org/extensions",
        "themeColor": color,
        "summary": `${severity}: ${vuln.cveID}`,
        "sections": [{
          "activityTitle": `${emoji} ${severity}: ${vuln.cveID}`,
          "activitySubtitle": `${vuln.vendorProject} - ${vuln.product}`,
          "facts": [
            { "name": "Description", "value": vuln.shortDescription || vuln.vulnerabilityName },
            { "name": "EPSS Score", "value": `${((vuln.epss || 0) * 100).toFixed(1)}%` },
            { "name": "Due Date", "value": vuln.dueDate },
            { "name": "Patch Available", "value": vuln.patchAvailable !== false ? '‚úÖ Yes' : '‚ùå No' },
            { "name": "Action Required", "value": isZeroDay ? 'üõë BLOCK/ISOLATE' : '‚úÖ PATCH NOW' }
          ],
          "markdown": true
        }],
        "potentialAction": [
          {
            "@type": "OpenUri",
            "name": "View on NVD",
            "targets": [{ "os": "default", "uri": `https://nvd.nist.gov/vuln/detail/${vuln.cveID}` }]
          },
          {
            "@type": "OpenUri",
            "name": "Open Dashboard",
            "targets": [{ "os": "default", "uri": "https://www.cvepulse.com" }]
          }
        ]
      };
    }

    // ===========================================
    // INIT
    // ===========================================
    document.addEventListener('DOMContentLoaded', () => {
      fetchAllData();
      setInterval(fetchAllData, 15 * 60 * 1000);
      
      // Check if push notifications were previously enabled
      if (localStorage.getItem('cvepulse_push_enabled') === 'true' && Notification.permission === 'granted') {
        pushNotificationsEnabled = true;
      }
      
      // Load watchlist
      updateWatchlistUI();
      
      // Load API key if exists
      loadApiKey();
      
      // Check for verification redirect
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('verified') === 'success') {
        alert('‚úÖ Email verified successfully! You will now receive vulnerability alerts.');
        // Clean up URL
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    });
  </script>
</body>
</html>
